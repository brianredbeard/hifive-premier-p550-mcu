From 6226c009c0fe11a94179d4a80a9e56ca5e5c57cd Mon Sep 17 00:00:00 2001
From: xuxiang <xuxiang@eswincomputing.com>
Date: Wed, 5 Jun 2024 13:11:27 +0800
Subject: [PATCH 070/109] WIN2030-15279:merge:win2030-dev merge into hf106-dev

Changelogs:
1. Commit: abd4c986589155f19dd91197204a6ad4f4fc7c7a
2. Commit message:WIN2030-15279:fix(hf_common.c):Fix HardFault when poweroffing som

Change-Id: I418e09bcae895aaa547c62841f220b4665015d64
---
 Core/Src/console.c                 |   56 +-
 Core/Src/hf_common.c               |    1 -
 Core/Src/hf_protocol_process.c     |   30 +-
 Core/Src/main.c                    |   65 +-
 Core/Src/protocol_lib/ringbuffer.c |   24 +-
 Core/Src/stm32f4xx_it.c            |  168 +--
 Core/Src/web-server.c              | 2080 ++++++++++++++--------------
 7 files changed, 1185 insertions(+), 1239 deletions(-)

diff --git a/Core/Src/console.c b/Core/Src/console.c
index 717d4fc..c1e1fdf 100644
--- a/Core/Src/console.c
+++ b/Core/Src/console.c
@@ -638,15 +638,15 @@ static BaseType_t prvCommandNetInfoGet(char *pcWriteBuffer, size_t xWriteBufferL
 */
 static BaseType_t prvCommandIPSet(char *pcWriteBuffer, size_t xWriteBufferLen, const char *pcCommandString)
 {
-	uint32_t naddr;
+    uint32_t naddr;
     const char * pcIPaddr;
     BaseType_t xParamLen;
 
     pcIPaddr = FreeRTOS_CLIGetParameter(pcCommandString, 1, &xParamLen);
 
-	/* set ipaddr */
-	naddr = ipaddr_addr(pcIPaddr);
-	es_set_mcu_ipaddr((uint8_t *)&naddr);
+    /* set ipaddr */
+    naddr = ipaddr_addr(pcIPaddr);
+    es_set_mcu_ipaddr((uint8_t *)&naddr);
 
     snprintf(pcWriteBuffer, xWriteBufferLen, "ip addr set to %s(0x%lx)\r\n", pcIPaddr, naddr);
 
@@ -663,15 +663,15 @@ static BaseType_t prvCommandIPSet(char *pcWriteBuffer, size_t xWriteBufferLen, c
 */
 static BaseType_t prvCommandNetMaskSet(char *pcWriteBuffer, size_t xWriteBufferLen, const char *pcCommandString)
 {
-	uint32_t naddr;
+    uint32_t naddr;
     const char * pcIPaddr;
     BaseType_t xParamLen;
 
     pcIPaddr = FreeRTOS_CLIGetParameter(pcCommandString, 1, &xParamLen);
 
-	/* set ipaddr */
-	naddr = ipaddr_addr(pcIPaddr);
-	es_set_mcu_netmask((uint8_t *)&naddr);
+    /* set ipaddr */
+    naddr = ipaddr_addr(pcIPaddr);
+    es_set_mcu_netmask((uint8_t *)&naddr);
 
     snprintf(pcWriteBuffer, xWriteBufferLen, "netmask addr set to %s(0x%lx)\r\n", pcIPaddr, naddr);
 
@@ -688,15 +688,15 @@ static BaseType_t prvCommandNetMaskSet(char *pcWriteBuffer, size_t xWriteBufferL
 */
 static BaseType_t prvCommandGateWaySet(char *pcWriteBuffer, size_t xWriteBufferLen, const char *pcCommandString)
 {
-	uint32_t naddr;
+    uint32_t naddr;
     const char * pcIPaddr;
     BaseType_t xParamLen;
 
     pcIPaddr = FreeRTOS_CLIGetParameter(pcCommandString, 1, &xParamLen);
 
-	/* set ipaddr */
-	naddr = ipaddr_addr(pcIPaddr);
-	es_set_mcu_gateway((uint8_t *)&naddr);
+    /* set ipaddr */
+    naddr = ipaddr_addr(pcIPaddr);
+    es_set_mcu_gateway((uint8_t *)&naddr);
 
     snprintf(pcWriteBuffer, xWriteBufferLen, "gateway addr set to %s(0x%lx)\r\n", pcIPaddr, naddr);
 
@@ -715,7 +715,7 @@ static BaseType_t prvCommandMacSet(char *pcWriteBuffer, size_t xWriteBufferLen,
 {
     const char * pcMACaddr;
     BaseType_t xParamLen;
-	uint8_t mac[6];
+    uint8_t mac[6];
 
     pcMACaddr = FreeRTOS_CLIGetParameter(pcCommandString, 1, &xParamLen);
 
@@ -855,12 +855,12 @@ static BaseType_t prvCommandHeap(char *pcWriteBuffer, size_t xWriteBufferLen, co
 */
 static BaseType_t prvCommandRtcGet(char *pcWriteBuffer, size_t xWriteBufferLen, const char *pcCommandString)
 {
-	struct rtc_date_t date = {0};
-	struct rtc_time_t time = {0};
+    struct rtc_date_t date = {0};
+    struct rtc_time_t time = {0};
     char cWeekDay[4] = {0};
 
-	es_get_rtc_date(&date);
-	es_get_rtc_time(&time);
+    es_get_rtc_date(&date);
+    es_get_rtc_time(&time);
 
     switch (date.WeekDay)
     {
@@ -998,16 +998,16 @@ static BaseType_t prvCommandTempGet(char *pcWriteBuffer, size_t xWriteBufferLen,
 */
 static BaseType_t prvCommandPwrDissipationGet(char *pcWriteBuffer, size_t xWriteBufferLen, const char *pcCommandString)
 {
-	uint32_t millivolt = 0, milliCur = 0, microWatt = 0; //millivolt, milliCurrent, milliwatt
-	power_info power_info = {0};
-
-	power_info = get_power_info();
-	millivolt = power_info.voltage;
-	milliCur = power_info.current;
-	microWatt = power_info.consumption;
-	snprintf(pcWriteBuffer, xWriteBufferLen,"consumption:%ld.%3.3ld(W)  voltage:%ld.%03ld(V)  current:%ld.%03ld(A)\n",
-		microWatt / 1000000, microWatt % 1000000, millivolt / 1000, millivolt % 1000, milliCur / 1000, milliCur % 1000);
-	return pdFALSE;
+    uint32_t millivolt = 0, milliCur = 0, microWatt = 0; //millivolt, milliCurrent, milliwatt
+    power_info power_info = {0};
+
+    power_info = get_power_info();
+    millivolt = power_info.voltage;
+    milliCur = power_info.current;
+    microWatt = power_info.consumption;
+    snprintf(pcWriteBuffer, xWriteBufferLen,"consumption:%ld.%3.3ld(W)  voltage:%ld.%03ld(V)  current:%ld.%03ld(A)\n",
+        microWatt / 1000000, microWatt % 1000000, millivolt / 1000, millivolt % 1000, milliCur / 1000, milliCur % 1000);
+    return pdFALSE;
 }
 
 
@@ -1236,7 +1236,7 @@ static HAL_StatusTypeDef vConsoleWrite(const char *buff)
     status = HAL_UART_Transmit(pxUartDevHandle, (uint8_t *)buff, strlen(buff), portMAX_DELAY);
     if (status != HAL_OK)
     {
-    	return HAL_ERROR;
+        return HAL_ERROR;
     }
     return status;
 }
diff --git a/Core/Src/hf_common.c b/Core/Src/hf_common.c
index d2610ed..89446b5 100644
--- a/Core/Src/hf_common.c
+++ b/Core/Src/hf_common.c
@@ -1009,7 +1009,6 @@ int es_eeprom_info_test(void)
 	return 0;
 }
 
-
 /**
  * @brief  eic7700 boot sel.
  * @param  sel 4'b, bit3:bootsel3 ,bit2:bootsel2; bit1:bootsel2; bit0:bootsel0
diff --git a/Core/Src/hf_protocol_process.c b/Core/Src/hf_protocol_process.c
index 78d45e1..780b784 100644
--- a/Core/Src/hf_protocol_process.c
+++ b/Core/Src/hf_protocol_process.c
@@ -426,28 +426,28 @@ TimerHandle_t xSomRestartTimer;
 
 // Function to initialize the mutex
 void init_transmit_mutex(void) {
-    // Create the mutex
-    xMutex = xSemaphoreCreateMutex();
-    // Check if the mutex was created successfully
-    if (xMutex == NULL) {
-        // Mutex creation failed
-        // Handle the error here
-    }
+	// Create the mutex
+	xMutex = xSemaphoreCreateMutex();
+	// Check if the mutex was created successfully
+	if (xMutex == NULL) {
+		// Mutex creation failed
+		// Handle the error here
+	}
 }
 
 // Function to acquire the mutex
 void acquire_transmit_mutex(void) {
-    // Attempt to take the mutex
-    if (xSemaphoreTake(xMutex, portMAX_DELAY) != pdPASS) {
-        // Failed to acquire the mutex
-        // Handle the error here
-    }
+	// Attempt to take the mutex
+	if (xSemaphoreTake(xMutex, portMAX_DELAY) != pdPASS) {
+		// Failed to acquire the mutex
+		// Handle the error here
+	}
 }
 
 // Function to release the mutex
 void release_transmit_mutex(void) {
-    // Release the mutex
-    xSemaphoreGive(xMutex);
+	// Release the mutex
+	xSemaphoreGive(xMutex);
 }
 
 // Function to check message checksum
@@ -806,4 +806,4 @@ void uart4_protocol_task(void *argument)
 			}
 		}
 	}
-}
+}
\ No newline at end of file
diff --git a/Core/Src/main.c b/Core/Src/main.c
index 9fdf383..60456e4 100644
--- a/Core/Src/main.c
+++ b/Core/Src/main.c
@@ -126,17 +126,16 @@ int main(void)
 }
 static void mcu_status_led_on(uint8_t turnon)
 {
-	if (HAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_4) != HAL_OK) {
-		printf("HAL_TIM_PWM_Start(&htim4,TIM_CHANNEL_4) err\n");
-		Error_Handler();
-	}
+  if (HAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_4) != HAL_OK) {
+    printf("HAL_TIM_PWM_Start(&htim4,TIM_CHANNEL_4) err\n");
+    Error_Handler();
+  }
 }
 /**
   * @brief  Function implementing the defaultTask thread.
   * @param  argument: Not used
   * @retval None
   */
-extern void get_rtc_info(void);
 extern void hf_power_task (void* parameter);
 extern void hf_gpio_task (void* parameter);
 
@@ -169,64 +168,12 @@ void hf_main_task(void *argument)
   }
   #endif
   // extern void MX_IWDG_Init(void);
-	// MX_IWDG_Init();
+  // MX_IWDG_Init();
 
-  // mcu_status_led_on(pdTRUE);
-  // extern uint32_t PWM2_T_Count;
-  // extern uint32_t PWM2_D_Count;
-  // uint32_t uiFrequency;
 
   for(;;)
   {
-		// uiFrequency = 1000000 / PWM2_D_Count;
-		// printf("占空:%dus    周期:%dus    频率:%dHz    \r\n", PWM2_T_Count, PWM2_D_Count, uiFrequency);
-    // PWM2_T_Count = 0;
-    // PWM2_D_Count = 0;
-    // uiFrequency = 0;
     // HAL_IWDG_Refresh(&hiwdg);
-    // get_rtc_info();
     osDelay(800);
   }
-}
-
-void fan_info(void)
-{
-  if (HAL_TIM_PWM_Start(&htim4,TIM_CHANNEL_1) != HAL_OK)
-	{
-	  printf("HAL_TIM_PWM_Start(&htim4,TIM_CHANNEL_1) err\n");
-	  Error_Handler();
-	}
-	if (HAL_TIM_PWM_Start(&htim4,TIM_CHANNEL_2) != HAL_OK)
-	{
-	  printf("HAL_TIM_PWM_Start(&htim4,TIM_CHANNEL_2) err\n");
-	  Error_Handler();
-	}
-
-  if (HAL_TIM_IC_Start_IT(&htim5,TIM_CHANNEL_1) != HAL_OK)
-	{
-	  printf("HAL_TIM_IC_Start(&htim5,TIM_CHANNEL_1) err\n");
-	  Error_Handler();
-	}
-	if (HAL_TIM_IC_Start_IT(&htim5,TIM_CHANNEL_2) != HAL_OK)
-	{
-		printf("HAL_TIM_IC_Start(&htim5,TIM_CHANNEL_2) err\n");
-		Error_Handler();
-	}
-}
-
-void get_rtc_info(void)
-{
-  RTC_DateTypeDef GetData;
-  RTC_TimeTypeDef GetTime;
-  HAL_RTC_GetTime(&hrtc, &GetTime, RTC_FORMAT_BIN);
-  /* Get the RTC current Date */
-  HAL_RTC_GetDate(&hrtc, &GetData, RTC_FORMAT_BIN);
-
-  /* Display date Format : yy/mm/dd */
-  printf("%s yy/mm/dd  %02d/%02d/%02d\r\n", __func__, 2000 + GetData.Year, GetData.Month, GetData.Date);
-  /* Display time Format : hh:mm:ss */
-  printf("%s hh:mm:ss %02d:%02d:%02d\r\n", __func__, GetTime.Hours, GetTime.Minutes, GetTime.Seconds);
-
-
-}
-
+}
\ No newline at end of file
diff --git a/Core/Src/protocol_lib/ringbuffer.c b/Core/Src/protocol_lib/ringbuffer.c
index 7876dbc..3eab89d 100644
--- a/Core/Src/protocol_lib/ringbuffer.c
+++ b/Core/Src/protocol_lib/ringbuffer.c
@@ -19,10 +19,10 @@ uint8_t ring_buf_init(ring_buf_t *r, uint32_t size)
 	}
 	memset(r->pHead, 0, sizeof(size));
 
-    r->pWrite = r->pHead;
-    r->pRead = r->pHead;
-    r->pTail = r->pHead + size;
-    r->is_full = 0; // Initialize is_full to false
+	r->pWrite = r->pHead;
+	r->pRead = r->pHead;
+	r->pTail = r->pHead + size;
+	r->is_full = 0; // Initialize is_full to false
 
 	return B_SUCCESS;
 }
@@ -40,7 +40,7 @@ void ring_buf_clr(ring_buf_t *r)
 	}
 	r->pWrite = r->pHead;
 	r->pRead = r->pHead;
-    r->is_full = 0; // Clear the is_full flag
+	r->is_full = 0; // Clear the is_full flag
 }
 
 int32_t get_ring_buf_len(ring_buf_t *r)
@@ -51,9 +51,9 @@ int32_t get_ring_buf_len(ring_buf_t *r)
 		printf("%s : RingBuff is not Init!\n", __func__);
 		return -1;
 	}
-    if (r->is_full) {
-        return r->pTail - r->pHead; // If buffer is full, length is equal to size
-    }
+	if (r->is_full) {
+		return r->pTail - r->pHead; // If buffer is full, length is equal to size
+	}
 	if (r->pRead > r->pWrite) {
 		len = r->pTail - r->pRead;
 		len += r->pWrite - r->pHead;
@@ -70,9 +70,9 @@ int32_t get_ring_buf_free_space(ring_buf_t *r)
 		printf("%s : RingBuff is not Init!\n", __func__);
 		return -1;
 	}
-    if (r->is_full) {
-        return 0; // If buffer is full, free space is 0
-    }
+	if (r->is_full) {
+		return 0; // If buffer is full, free space is 0
+	}
 	if (r->pRead > r->pWrite) {
 		len = r->pRead - r->pWrite;
 	} else {
@@ -193,7 +193,7 @@ int ring_buf_clr_len(ring_buf_t *r, uint32_t len)
 	if (len > get_ring_buf_len(r)) {
 		printf("%s : len is larger than the valid area and clean the buf!\n", __func__);
 		r->pRead = r->pWrite = r->pHead;
-	} else  if (r->pRead + len > r->pTail) {
+	} else if (r->pRead + len > r->pTail) {
 		uint32_t last_len = len - (r->pTail - r->pRead);
 		r->pRead = r->pHead + last_len;
 	} else {
diff --git a/Core/Src/stm32f4xx_it.c b/Core/Src/stm32f4xx_it.c
index 15bc781..30778e9 100644
--- a/Core/Src/stm32f4xx_it.c
+++ b/Core/Src/stm32f4xx_it.c
@@ -99,94 +99,94 @@ void NMI_Handler(void)
 void HardFault_Handler(void) __attribute__((naked));
 void HardFault_Handler(void)
 {
-	__asm volatile (
-		"TST lr, #4 \n" // Test EXC_RETURN bit 2
-		"ITE EQ \n"     // If-Then-Else (EQ)
-		"MRSEQ r0, MSP \n" // Main Stack Pointer to r0 if EQ
-		"MRSNE r0, PSP \n" // Process Stack Pointer to r0 if NE
-		"B HardFault_Handler_C \n" // Branch to C handler
-	);
+  __asm volatile (
+    "TST lr, #4 \n" // Test EXC_RETURN bit 2
+    "ITE EQ \n"     // If-Then-Else (EQ)
+    "MRSEQ r0, MSP \n" // Main Stack Pointer to r0 if EQ
+    "MRSNE r0, PSP \n" // Process Stack Pointer to r0 if NE
+    "B HardFault_Handler_C \n" // Branch to C handler
+  );
 }
 
 void HardFault_Handler_C(uint32_t *pulFaultStackAddress)
 {
-	// Extract values from the stack
-	uint32_t r0  = pulFaultStackAddress[0];
-	uint32_t r1  = pulFaultStackAddress[1];
-	uint32_t r2  = pulFaultStackAddress[2];
-	uint32_t r3  = pulFaultStackAddress[3];
-	uint32_t r12 = pulFaultStackAddress[4];
-	uint32_t lr  = pulFaultStackAddress[5];
-	uint32_t pc  = pulFaultStackAddress[6];
-	uint32_t psr = pulFaultStackAddress[7];
-
-	// Read fault status registers
-	uint32_t CFSR = SCB->CFSR;    // Configurable Fault Status Register
-	uint32_t HFSR = SCB->HFSR;    // Hard Fault Status Register
-	uint32_t DFSR = SCB->DFSR;    // Debug Fault Status Register
-	uint32_t AFSR = SCB->AFSR;    // Auxiliary Fault Status Register
-	uint32_t MMAR = SCB->MMFAR;   // MemManage Fault Address Register
-	uint32_t BFAR = SCB->BFAR;    // Bus Fault Address Register
-
-	// Print the fault information
-	printf("HardFault detected!\n");
-	printf("R0  = 0x%08lX\n", r0);
-	printf("R1  = 0x%08lX\n", r1);
-	printf("R2  = 0x%08lX\n", r2);
-	printf("R3  = 0x%08lX\n", r3);
-	printf("R12 = 0x%08lX\n", r12);
-	printf("LR  = 0x%08lX\n", lr);
-	printf("PC  = 0x%08lX\n", pc);
-	printf("PSR = 0x%08lX\n", psr);
-
-	printf("CFSR = 0x%08lX\n", CFSR);
-	printf("HFSR = 0x%08lX\n", HFSR);
-	printf("DFSR = 0x%08lX\n", DFSR);
-	printf("AFSR = 0x%08lX\n", AFSR);
-	printf("MMAR = 0x%08lX\n", MMAR);
-	printf("BFAR = 0x%08lX\n", BFAR);
-
-	// Decode CFSR to get specific fault details
-	if (CFSR & 0x00000001) printf("MemManage Fault: Instruction Access Violation\n");
-	if (CFSR & 0x00000002) printf("MemManage Fault: Data Access Violation\n");
-	if (CFSR & 0x00000008) printf("MemManage Fault: Unstacking Error\n");
-	if (CFSR & 0x00000010) printf("MemManage Fault: Stacking Error\n");
-	if (CFSR & 0x00000080) printf("MemManage Fault: MemManage Address Register Valid\n");
-	if (CFSR & 0x00000100) printf("Bus Fault: Instruction Access Violation\n");
-	if (CFSR & 0x00000200) printf("Bus Fault: Precise Data Access Violation\n");
-	if (CFSR & 0x00000400) printf("Bus Fault: Imprecise Data Access Violation\n");
-	if (CFSR & 0x00000800) printf("Bus Fault: Unstacking Error\n");
-	if (CFSR & 0x00001000) printf("Bus Fault: Stacking Error\n");
-	if (CFSR & 0x00008000) printf("Bus Fault: Bus Fault Address Register Valid\n");
-	if (CFSR & 0x01000000) printf("Usage Fault: Undefined Instruction\n");
-	if (CFSR & 0x02000000) printf("Usage Fault: Invalid State\n");
-	if (CFSR & 0x04000000) printf("Usage Fault: Invalid PC Load Usage Fault\n");
-	if (CFSR & 0x08000000) printf("Usage Fault: No Coprocessor\n");
-	if (CFSR & 0x10000000) printf("Usage Fault: Unaligned Access\n");
-	if (CFSR & 0x20000000) printf("Usage Fault: Divide By Zero\n");
-
-	// Decode HFSR to get specific fault details
-	if (HFSR & (1 << 0)) printf("Hard Fault: Reserved\n");
-	if (HFSR & (1 << 1)) printf("Hard Fault: Vector Table Read Fault\n");
-	if (HFSR & (1 << 30)) printf("Hard Fault: Forced Hard Fault\n");
-	if (HFSR & (1 << 31)) printf("Hard Fault: Debug Event\n");
-
-	// Decode DFSR to get specific fault details
-	if (DFSR & (1 << 0)) printf("Debug Fault: Halt requested by debugger\n");
-	if (DFSR & (1 << 1)) printf("Debug Fault: Breakpoint occurred\n");
-	if (DFSR & (1 << 2)) printf("Debug Fault: Data Watchpoint occurred\n");
-	if (DFSR & (1 << 3)) printf("Debug Fault: Vector catch occurred\n");
-	if (DFSR & (1 << 4)) printf("Debug Fault: External debug request\n");
-
-	// Decode AFSR to get specific fault details
-	if (AFSR != 0) printf("Auxiliary Fault Status: 0x%08lX\n", AFSR);
-
-	// Decode MMAR and BFAR to get specific fault details
-	if (CFSR & 0x00000080) printf("MemManage Fault Address: 0x%08lX\n", MMAR);
-	if (CFSR & 0x00008000) printf("Bus Fault Address: 0x%08lX\n", BFAR);
-
-	// Infinite loop to halt the system for debugging
-	while (1);
+  // Extract values from the stack
+  uint32_t r0  = pulFaultStackAddress[0];
+  uint32_t r1  = pulFaultStackAddress[1];
+  uint32_t r2  = pulFaultStackAddress[2];
+  uint32_t r3  = pulFaultStackAddress[3];
+  uint32_t r12 = pulFaultStackAddress[4];
+  uint32_t lr  = pulFaultStackAddress[5];
+  uint32_t pc  = pulFaultStackAddress[6];
+  uint32_t psr = pulFaultStackAddress[7];
+
+  // Read fault status registers
+  uint32_t CFSR = SCB->CFSR;    // Configurable Fault Status Register
+  uint32_t HFSR = SCB->HFSR;    // Hard Fault Status Register
+  uint32_t DFSR = SCB->DFSR;    // Debug Fault Status Register
+  uint32_t AFSR = SCB->AFSR;    // Auxiliary Fault Status Register
+  uint32_t MMAR = SCB->MMFAR;   // MemManage Fault Address Register
+  uint32_t BFAR = SCB->BFAR;    // Bus Fault Address Register
+
+  // Print the fault information
+  printf("HardFault detected!\n");
+  printf("R0  = 0x%08lX\n", r0);
+  printf("R1  = 0x%08lX\n", r1);
+  printf("R2  = 0x%08lX\n", r2);
+  printf("R3  = 0x%08lX\n", r3);
+  printf("R12 = 0x%08lX\n", r12);
+  printf("LR  = 0x%08lX\n", lr);
+  printf("PC  = 0x%08lX\n", pc);
+  printf("PSR = 0x%08lX\n", psr);
+
+  printf("CFSR = 0x%08lX\n", CFSR);
+  printf("HFSR = 0x%08lX\n", HFSR);
+  printf("DFSR = 0x%08lX\n", DFSR);
+  printf("AFSR = 0x%08lX\n", AFSR);
+  printf("MMAR = 0x%08lX\n", MMAR);
+  printf("BFAR = 0x%08lX\n", BFAR);
+
+  // Decode CFSR to get specific fault details
+  if (CFSR & 0x00000001) printf("MemManage Fault: Instruction Access Violation\n");
+  if (CFSR & 0x00000002) printf("MemManage Fault: Data Access Violation\n");
+  if (CFSR & 0x00000008) printf("MemManage Fault: Unstacking Error\n");
+  if (CFSR & 0x00000010) printf("MemManage Fault: Stacking Error\n");
+  if (CFSR & 0x00000080) printf("MemManage Fault: MemManage Address Register Valid\n");
+  if (CFSR & 0x00000100) printf("Bus Fault: Instruction Access Violation\n");
+  if (CFSR & 0x00000200) printf("Bus Fault: Precise Data Access Violation\n");
+  if (CFSR & 0x00000400) printf("Bus Fault: Imprecise Data Access Violation\n");
+  if (CFSR & 0x00000800) printf("Bus Fault: Unstacking Error\n");
+  if (CFSR & 0x00001000) printf("Bus Fault: Stacking Error\n");
+  if (CFSR & 0x00008000) printf("Bus Fault: Bus Fault Address Register Valid\n");
+  if (CFSR & 0x01000000) printf("Usage Fault: Undefined Instruction\n");
+  if (CFSR & 0x02000000) printf("Usage Fault: Invalid State\n");
+  if (CFSR & 0x04000000) printf("Usage Fault: Invalid PC Load Usage Fault\n");
+  if (CFSR & 0x08000000) printf("Usage Fault: No Coprocessor\n");
+  if (CFSR & 0x10000000) printf("Usage Fault: Unaligned Access\n");
+  if (CFSR & 0x20000000) printf("Usage Fault: Divide By Zero\n");
+
+  // Decode HFSR to get specific fault details
+  if (HFSR & (1 << 0)) printf("Hard Fault: Reserved\n");
+  if (HFSR & (1 << 1)) printf("Hard Fault: Vector Table Read Fault\n");
+  if (HFSR & (1 << 30)) printf("Hard Fault: Forced Hard Fault\n");
+  if (HFSR & (1 << 31)) printf("Hard Fault: Debug Event\n");
+
+  // Decode DFSR to get specific fault details
+  if (DFSR & (1 << 0)) printf("Debug Fault: Halt requested by debugger\n");
+  if (DFSR & (1 << 1)) printf("Debug Fault: Breakpoint occurred\n");
+  if (DFSR & (1 << 2)) printf("Debug Fault: Data Watchpoint occurred\n");
+  if (DFSR & (1 << 3)) printf("Debug Fault: Vector catch occurred\n");
+  if (DFSR & (1 << 4)) printf("Debug Fault: External debug request\n");
+
+  // Decode AFSR to get specific fault details
+  if (AFSR != 0) printf("Auxiliary Fault Status: 0x%08lX\n", AFSR);
+
+  // Decode MMAR and BFAR to get specific fault details
+  if (CFSR & 0x00000080) printf("MemManage Fault Address: 0x%08lX\n", MMAR);
+  if (CFSR & 0x00008000) printf("Bus Fault Address: 0x%08lX\n", BFAR);
+
+  // Infinite loop to halt the system for debugging
+  while (1);
 }
 
 /**
diff --git a/Core/Src/web-server.c b/Core/Src/web-server.c
index be6d5ca..a4c4925 100644
--- a/Core/Src/web-server.c
+++ b/Core/Src/web-server.c
@@ -8997,12 +8997,12 @@ static const unsigned char data_jquery_min_js[] = {
 
 
 const unsigned char login_html[] ="<html lang=\"zh\"> \
-                                    <head> \
-                                        <meta charset=\"UTF-8\"> \
-                                        <title>User Login</title> \
+									<head> \
+										<meta charset=\"UTF-8\"> \
+										<title>User Login</title> \
 										<link rel=\"icon\" href=\"data:,\"> \
 										<script src=\"/jquery.min.js\"></script> \
- 										<script> \n \
+										<script> \n \
 											$(document).ready(function() { \n \
 												$('#loginForm').submit(function(event) { \n \
 													event.preventDefault();  \n \
@@ -9052,35 +9052,35 @@ const unsigned char login_html[] ="<html lang=\"zh\"> \
 											width: 200px;\
 										} \
 										</style> \
-                                    </head> \
-                                    <body > \
+									</head> \
+									<body > \
 									<div style=\"display: flex; flex-direction: column; align-items: center;\"> \
-                                        <h2>User Login</h2> \
-                                        <form action=\"/login\"  id=\"loginForm\" method=\"POST\"  > \
+										<h2>User Login</h2> \
+										<form action=\"/login\"  id=\"loginForm\" method=\"POST\"  > \
 												<div class=\"network-row\"> \
 													<label for=\"username\">Username:</label> <input type=\"text\" id=\"username\" name=\"username\" required> \
 												</div> \
 												<div class=\"network-row\"> \
-                                                	<label for=\"password\">Password:</label>  <input type=\"password\" id=\"password\" name=\"password\" required> \
+													<label for=\"password\">Password:</label>  <input type=\"password\" id=\"password\" name=\"password\" required> \
 												</div>\
-                                            <div> \
-                                                <button type=\"submit\">Login</button> \
-                                            </div> \
-                                        </form> \
+											<div> \
+												<button type=\"submit\">Login</button> \
+											</div> \
+										</form> \
 									</div> \
-                                    </body> \
-                                    </html> ";
+									</body> \
+									</html> ";
 
 
 
 const unsigned char info_html[] ="<html lang=\"en\"> \
-                                    <head> \
-                                        <meta charset=\"UTF-8\"> \
-                                        <title>Machine Status</title> \
+									<head> \
+										<meta charset=\"UTF-8\"> \
+										<title>Machine Status</title> \
 										<link rel=\"icon\" href=\"data:,\"> \
-                                         <script src=\"/jquery.min.js\"></script> \
-										 <script> \n \
-                                                $(document).ready(function() { \n \
+										<script src=\"/jquery.min.js\"></script> \
+										<script> \n \
+												$(document).ready(function() { \n \
 													var power_on_change_countdown=5;//click button timeout count \n \
 													function isValidMacAddress(mac) {\n \
 														const macAddressRegex = /^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/;\n \
@@ -9090,21 +9090,21 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 														var ipRegex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n \
 														return ipRegex.test(ip);\n \
 													}\n \
-                                                    $('#net-work-update').click(function() { \n \
-                                                        var ipaddr = $('#ipaddr').val();\n \
-                                                        var gateway = $('#gateway').val();\n \
-                                                        var subnetwork = $('#subnetwork').val();\n \
+													$('#net-work-update').click(function() { \n \
+														var ipaddr = $('#ipaddr').val();\n \
+														var gateway = $('#gateway').val();\n \
+														var subnetwork = $('#subnetwork').val();\n \
 														var macaddr = $('#macaddr').val();\n \
-                                                        $.ajax({ \n\
-                                                            url: '/network',\n \
-                                                            type: 'POST',\n \
-                                                            contentType: 'application/x-www-form-urlencoded', \n \
-                                                            data: {\n \
-                                                                ipaddr: ipaddr,\n \
-                                                                gateway: gateway,\n \
-                                                                subnetwork: subnetwork, \n \
+														$.ajax({ \n\
+															url: '/network',\n \
+															type: 'POST',\n \
+															contentType: 'application/x-www-form-urlencoded', \n \
+															data: {\n \
+																ipaddr: ipaddr,\n \
+																gateway: gateway,\n \
+																subnetwork: subnetwork, \n \
 																macaddr: macaddr \n \
-                                                            },\n \
+															},\n \
 															beforeSend: function() { \n \
 																if(!(macaddr.length>0 && isValidMacAddress(macaddr))){\n \
 																	alert('macaddr illegal!' );\n \
@@ -9123,132 +9123,132 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																	return false;\n \
 																}\n \
 															},\n \
-                                                            success: function(response) {\n \
-                                                                if(response.status===0){\n \
-                                                                    alert(\"update success!\");\n \
-                                                                }else{\n \
-                                                                    alert(response.message);\n \
-                                                                }\n \
-                                                                console.log('Network settings updated successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                alert(\"udpate failed!\");\n \
-                                                                console.error('Error updating network settings:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
-                                                    $('#net-work-refresh-hid').click(function() {\n \
-                                                        $.ajax({\n \
+															success: function(response) {\n \
+																if(response.status===0){\n \
+																	alert(\"update success!\");\n \
+																}else{\n \
+																	alert(response.message);\n \
+																}\n \
+																console.log('Network settings updated successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																alert(\"udpate failed!\");\n \
+																console.error('Error updating network settings:', error);\n \
+															}\n \
+														});\n \
+													});\n \
+													$('#net-work-refresh-hid').click(function() {\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/network',\n \
-                                                            type: 'GET',\n \
+															url: '/network',\n \
+															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#net-work-refresh-hid').val(),\n \
-                                                            },\
-                                                            success: function(response) {\n \
+																byhand: $('#net-work-refresh-hid').val(),\n \
+															},\
+															success: function(response) {\n \
 																if(response.status===0){ \n \
 																	$('#ipaddr').val(response.data.ipaddr);\n \
 																	$('#gateway').val(response.data.gateway);\n \
 																	$('#subnetwork').val(response.data.subnetwork);\n \
 																	$('#macaddr').val(response.data.macaddr);\n \
 																}\n \
-                                                                console.log('Network settings refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing network settings:', error);\n \
-                                                            }\n \
-                                                        });\n\
-                                                    });\n\
+																console.log('Network settings refreshed successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing network settings:', error);\n \
+															}\n \
+														});\n\
+													});\n\
 													$('#net-work-refresh').click(function() { \n \
-                                                        $('#net-work-refresh-hid').val(\"1\"); \n \
+														$('#net-work-refresh-hid').val(\"1\"); \n \
 														$('#net-work-refresh-hid').click(); \n \
 														$('#net-work-refresh-hid').val(\"0\"); \n \
-                                                    }); \n \
+													}); \n \
 													$('#power-on-change').click(function() {\n \
-													 	var power_status = $('#power-on-change').val();\n \
+														var power_status = $('#power-on-change').val();\n \
 														$('#power-consum-refresh').prop(\"disabled\", true); \n \
 														$('#reset').prop(\"disabled\", true); \n \
 														$('#soc-refresh').prop(\"disabled\", true); \n \
 														power_on_change_countdown=5;//5*1000ms \n \
-                                                        $.ajax({\n \
-                                                            url: '/power_status',\n \
-                                                            type: 'POST',\n \
-                                                            contentType: 'application/x-www-form-urlencoded', // 设置Content-Type \n \
-                                                            data: {\n \
-                                                                power_status: power_status,\n \
-                                                            },\
-                                                            success: function(response) {\n \
-                                                                if(response.status===0){\n \
-                                                                    alert(\"update success!\");\n \
-                                                                }else{\n \
-                                                                    alert(response.message);\n \
-                                                                }\n \
-                                                                console.log('power-on-change updated successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                alert(\"udpate failed!\");\n \
-                                                                console.error('Error updating power-on-change settings:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n\
+														$.ajax({\n \
+															url: '/power_status',\n \
+															type: 'POST',\n \
+															contentType: 'application/x-www-form-urlencoded', // 设置Content-Type \n \
+															data: {\n \
+																power_status: power_status,\n \
+															},\
+															success: function(response) {\n \
+																if(response.status===0){\n \
+																	alert(\"update success!\");\n \
+																}else{\n \
+																	alert(response.message);\n \
+																}\n \
+																console.log('power-on-change updated successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																alert(\"udpate failed!\");\n \
+																console.error('Error updating power-on-change settings:', error);\n \
+															}\n \
+														});\n \
+													});\n\
 													$('#power-lostresume-change').click(function() {\n \
-													 	var power_lostresume_status = $('#power-lostresume-change').val();\n \
-                                                        $.ajax({\n \
-                                                            url: '/power_lostresume_status',\n \
-                                                            type: 'POST',\n \
-                                                            contentType: 'application/x-www-form-urlencoded',  \n \
-                                                            data: {\n \
-                                                                power_lostresume_status: power_lostresume_status,\n \
-                                                            },\
-                                                            success: function(response) {\n \
+														var power_lostresume_status = $('#power-lostresume-change').val();\n \
+														$.ajax({\n \
+															url: '/power_lostresume_status',\n \
+															type: 'POST',\n \
+															contentType: 'application/x-www-form-urlencoded',  \n \
+															data: {\n \
+																power_lostresume_status: power_lostresume_status,\n \
+															},\
+															success: function(response) {\n \
 																$('#power-lostresume-refresh-hid').click(); \n \
-                                                                if(response.status===0){\n \
-                                                                    alert(\"update success!\");\n \
-                                                                }else{\n \
-                                                                    alert(response.message);\n \
-                                                                }\n \
-                                                                console.log('power-on-change updated successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                alert(\"udpate failed!\");\n \
-                                                                console.error('Error updating power-lostresume-change settings:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n\
+																if(response.status===0){\n \
+																	alert(\"update success!\");\n \
+																}else{\n \
+																	alert(response.message);\n \
+																}\n \
+																console.log('power-on-change updated successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																alert(\"udpate failed!\");\n \
+																console.error('Error updating power-lostresume-change settings:', error);\n \
+															}\n \
+														});\n \
+													});\n\
 													$('#reset').click(function() { \n \
 														if($('#power-on-change').val()==='1' || power_on_change_countdown > 0 ){ //off status \n \
 															return; \n \
 														}\n \
-                                                        $.ajax({ \n\
-                                                            url: '/reset',\n \
-                                                            type: 'POST',\n \
-                                                            contentType: 'application/x-www-form-urlencoded', \n \
-                                                            success: function(response) {\n \
-                                                                if(response.status===0){\n \
-                                                                    alert(\"reset success!\");\n \
-                                                                }else{\n \
-                                                                    alert(response.message);\n \
-                                                                }\n \
-                                                                console.log('Reset successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                alert(\"reset failed!\");\n \
-                                                                console.error('Error Reset:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+														$.ajax({ \n\
+															url: '/reset',\n \
+															type: 'POST',\n \
+															contentType: 'application/x-www-form-urlencoded', \n \
+															success: function(response) {\n \
+																if(response.status===0){\n \
+																	alert(\"reset success!\");\n \
+																}else{\n \
+																	alert(response.message);\n \
+																}\n \
+																console.log('Reset successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																alert(\"reset failed!\");\n \
+																console.error('Error Reset:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#power-consum-refresh-hid').click(function() {\n \
 														if($('#power-on-change').val()===1 || power_on_change_countdown>0){ //off status \n \
 															return; \n \
 														}\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/power_consum',\n \
-                                                            type: 'GET',\n \
+															url: '/power_consum',\n \
+															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#power-consum-refresh-hid').val(),\n \
-                                                            },\
-                                                            success: function(response) {\n \
+																byhand: $('#power-consum-refresh-hid').val(),\n \
+															},\
+															success: function(response) {\n \
 																if(response.status===0){\n \
 																	var consumption = parseFloat(response.data.consumption)/ 1000000; \n \
 																	$('#power_consum').val(consumption.toFixed(2)); \n \
@@ -9257,28 +9257,28 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																	var voltage = parseFloat(response.data.voltage)/ 1000; \n \
 																	$('#power_vol').val(voltage.toFixed(2));\n \
 																} \n \
-                                                                console.log('power_consum refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing power_consum:', error);\n \
-                                                            }\n \
-                                                        });\n\
-                                                    });\n\
+																console.log('power_consum refreshed successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing power_consum:', error);\n \
+															}\n \
+														});\n\
+													});\n\
 													$('#power-consum-refresh').click(function() { \n \
-                                                        $('#power-consum-refresh-hid').val(\"1\"); \n \
+														$('#power-consum-refresh-hid').val(\"1\"); \n \
 														$('#power-consum-refresh-hid').click(); \n \
 														$('#power-consum-refresh-hid').val(\"0\"); \n \
-                                                    }); \n \
+													}); \n \
 													$('#pvt-info-refresh-hid').click(function() {\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/pvt_info',\n \
-                                                            type: 'GET',\n \
+															url: '/pvt_info',\n \
+															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#pvt-info-refresh-hid').val(),\n \
-                                                            },\
+																byhand: $('#pvt-info-refresh-hid').val(),\n \
+															},\
 															contentType: 'application/x-www-form-urlencoded', \n \
-                                                            success: function(response) {\n \
+															success: function(response) {\n \
 																if(response.status===0){\n \
 																	var cpu_temp = parseFloat(response.data.cpu_temp)/ 1000; \n \
 																	$('#cpu_temp').val(cpu_temp.toFixed(2));\n \
@@ -9287,32 +9287,32 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																	var fan_speed = parseFloat(response.data.fan_speed); \n \
 																	$('#fan_speed').val(fan_speed);\n \
 																}\n \
-                                                                console.log('pvt info refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing pvt info:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+																console.log('pvt info refreshed successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing pvt info:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#pvt-info-refresh').click(function() { \n \
-                                                        $('#pvt-info-refresh-hid').val(\"1\"); \n \
+														$('#pvt-info-refresh-hid').val(\"1\"); \n \
 														$('#pvt-info-refresh-hid').click(); \n \
 														$('#pvt-info-refresh-hid').val(\"0\"); \n \
-                                                    }); \n \
+													}); \n \
 													var $dipRadios = $('.network-roww.option-row input[type=\"radio\"]');\n \
 													function toggleDipRadios(isEnabled) {\n \
 														$dipRadios.prop('disabled', !isEnabled);\n \
 													}\n \
 													$('#dip-switch-show-refresh-hid').click(function() {\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/dip_switch',\n \
-                                                            type: 'GET',\n \
+															url: '/dip_switch',\n \
+															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#dip-switch-show-refresh-hid').val(),\n \
-                                                            },\
+																byhand: $('#dip-switch-show-refresh-hid').val(),\n \
+															},\
 															contentType: 'application/x-www-form-urlencoded', \n \
-                                                            success: function(response) {\n \
+															success: function(response) {\n \
 																if(response.status===0){\n \
 																	$('input[name=\"dip01-show\"][value=\"' + response.data.dip01 + '\"]').prop('checked', true);\n \
 																	$('input[name=\"dip02-show\"][value=\"' + response.data.dip02 + '\"]').prop('checked', true);\n \
@@ -9320,71 +9320,71 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																	$('input[name=\"dip04-show\"][value=\"' + response.data.dip04 + '\"]').prop('checked', true);\n \
 																	$('input[name=\"swctrl-show\"][value=\"' + response.data.swctrl + '\"]').prop('checked', true);\n \
 																} \n \
-                                                                console.log('dip_switch refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing dip_switch:', error);\n \
-                                                            }\n \
-                                                        });\n\
-                                                    });\n\
+																console.log('dip_switch refreshed successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing dip_switch:', error);\n \
+															}\n \
+														});\n\
+													});\n\
 													$('#dip-switch-refresh-hid').click(function() {//refresh value from server \n \
 														$('input[name=\"swctrl\"][value=\"' + $('input[name=\"swctrl-show\"]:checked').val() + '\"]').prop('checked', true);\n \
 														$('input[name=\"dip01\"][value=\"' + $('input[name=\"dip01-show\"]:checked').val() + '\"]').prop('checked', true);\n \
-                                                        $('input[name=\"dip02\"][value=\"' + $('input[name=\"dip02-show\"]:checked').val() + '\"]').prop('checked', true);\n \
+														$('input[name=\"dip02\"][value=\"' + $('input[name=\"dip02-show\"]:checked').val() + '\"]').prop('checked', true);\n \
 														$('input[name=\"dip03\"][value=\"' + $('input[name=\"dip03-show\"]:checked').val() + '\"]').prop('checked', true);\n \
 														$('input[name=\"dip04\"][value=\"' + $('input[name=\"dip04-show\"]:checked').val() + '\"]').prop('checked', true);\n \
 														toggleDipRadios($('input[name=\"swctrl\"]:checked').val() === '1');\n \
-                                                    });\n\
+													});\n\
 													$('#dip-switch-show-refresh').click(function() { \n \
-                                                        $('#dip-switch-show-refresh-hid').val(\"1\"); \n \
+														$('#dip-switch-show-refresh-hid').val(\"1\"); \n \
 														$('#dip-switch-show-refresh-hid').click(); \n \
 														$('#dip-switch-show-refresh-hid').val(\"0\"); \n \
-                                                    }); \n \
+													}); \n \
 													$('#dip-switch-update').click(function() { \n \
-                                                        var dip01 = $('input[name=\"dip01\"]:checked').val(); \n \
+														var dip01 = $('input[name=\"dip01\"]:checked').val(); \n \
 														var dip02 = $('input[name=\"dip02\"]:checked').val(); \n \
 														var dip03 = $('input[name=\"dip03\"]:checked').val(); \n \
 														var dip04 = $('input[name=\"dip04\"]:checked').val(); \n \
 														var swctrl = $('input[name=\"swctrl\"]:checked').val(); \n \
-                                                        $.ajax({ \n\
-                                                            url: '/dip_switch',\n \
-                                                            type: 'POST',\n \
-                                                            contentType: 'application/x-www-form-urlencoded', \n \
-                                                            data: {\n \
-                                                                dip01: dip01, \n \
-                                                                dip02: dip02, \n \
-                                                                dip03: dip03, \n \
+														$.ajax({ \n\
+															url: '/dip_switch',\n \
+															type: 'POST',\n \
+															contentType: 'application/x-www-form-urlencoded', \n \
+															data: {\n \
+																dip01: dip01, \n \
+																dip02: dip02, \n \
+																dip03: dip03, \n \
 																dip04: dip04, \n \
 																swctrl: swctrl \n \
-                                                            },\
-                                                            success: function(response) {\n \
-                                                                if(response.status===0){\n \
-                                                                    alert(\"update success!\");\n \
-                                                                }else{\n \
-                                                                    alert(response.message);\n \
-                                                                }\n \
-                                                                console.log('dip-switch settings updated successfully.');\n \
+															},\
+															success: function(response) {\n \
+																if(response.status===0){\n \
+																	alert(\"update success!\");\n \
+																}else{\n \
+																	alert(response.message);\n \
+																}\n \
+																console.log('dip-switch settings updated successfully.');\n \
 																$('#dip-switch-show-refresh-hid').click(); \n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                alert(\"udpate failed!\");\n \
-                                                                console.error('Error updating dip-switch settings:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																alert(\"udpate failed!\");\n \
+																console.error('Error updating dip-switch settings:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#power-on-refresh-hid').click(function() {\n \
 														$('#power-on-change').prop(\"disabled\", true); \n \
 														$('#power-consum-refresh').prop(\"disabled\", true); \n \
 														$('#reset').prop(\"disabled\", true); \n \
 														$('#soc-refresh').prop(\"disabled\", true); \n \
 														$('#power-on-change').text('loading,,,');\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/power_status',\n \
+															url: '/power_status',\n \
 															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#power-on-refresh-hid').val(),\n \
-                                                            },\
+																byhand: $('#power-on-refresh-hid').val(),\n \
+															},\
 															contentType: 'application/x-www-form-urlencoded', \n \
 															success: function(response) {\n \
 																if(response.status===0){\n \
@@ -9409,18 +9409,18 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 															error: function(xhr, status, error) {\n \
 																console.error('An error occurred:', error);\n \
 															}\n \
-                                                        });\n\
-                                                    });\n\
+														});\n\
+													});\n\
 													$('#power-lostresume-refresh-hid').click(function() {\n \
 														$('#power-lostresume-change').prop(\"disabled\", true); \n \
 														$('#power-lostresume-change').text('loading,,,');\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/power_lostresume_status',\n \
+															url: '/power_lostresume_status',\n \
 															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#power-lostresume-refresh-hid').val(),\n \
-                                                            },\
+																byhand: $('#power-lostresume-refresh-hid').val(),\n \
+															},\
 															contentType: 'application/x-www-form-urlencoded', \n \
 															success: function(response) {\n \
 																if(response.status===0){\n \
@@ -9439,14 +9439,14 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 															error: function(xhr, status, error) {\n \
 																console.error('An error occurred:', error);\n \
 															}\n \
-                                                        });\n\
-                                                    });\n \
+														});\n\
+													});\n \
 													$('#board-info-som-refresh').click(function() {\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/board_info_som',\n \
-                                                            type: 'GET',\n \
-                                                            success: function(response) {\n \
+															url: '/board_info_som',\n \
+															type: 'GET',\n \
+															success: function(response) {\n \
 																if(response.status===0){ \n \
 																	$('#som_magicNumber').val(response.data.magicNumber);\n \
 																	$('#som_formatVersionNumber').val(response.data.formatVersionNumber);\n \
@@ -9458,18 +9458,18 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																	console.log('board-info-som-refresh refreshed else #####.');\n \
 																} \n \
 																console.log('board-info-som-refresh refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing board-info-som-refresh:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing board-info-som-refresh:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#board-info-cb-refresh').click(function() {\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/board_info_cb',\n \
-                                                            type: 'GET',\n \
-                                                            success: function(response) {\n \
+															url: '/board_info_cb',\n \
+															type: 'GET',\n \
+															success: function(response) {\n \
 																if(response.status===0){ \n \
 																	$('#cb_magicNumber').val(response.data.magicNumber);\n \
 																	$('#cb_formatVersionNumber').val(response.data.formatVersionNumber);\n \
@@ -9477,22 +9477,22 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																	$('#cb_pcbRevision').val(response.data.pcbRevision);\n \
 																	$('#cb_boardSerialNumber').val(response.data.boardSerialNumber);\n \
 																}\n \
-                                                                console.log('board-info-cb-refresh refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing board-info-cb-refresh:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+																console.log('board-info-cb-refresh refreshed successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing board-info-cb-refresh:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#rtc-refresh-hid').click(function() {\n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/rtc',\n \
-                                                            type: 'GET',\n \
+															url: '/rtc',\n \
+															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#rtc-refresh-hid').val(),\n \
-                                                            },\
-                                                            success: function(response) {\n \
+																byhand: $('#rtc-refresh-hid').val(),\n \
+															},\
+															success: function(response) {\n \
 																if(response.status===0){ \n \
 																	$('#rtc_year').val(response.data.year);\n \
 																	$('#rtc_month').val(response.data.month);\n \
@@ -9509,39 +9509,39 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																				response.data.seconds; \
 																	$('#rtc_datetime').val(rtc_datetime); \
 																}\n \
-                                                                console.log('rtc refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing rtc:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+																console.log('rtc refreshed successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing rtc:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#rtc-refresh').click(function() { \n \
-                                                        $('#rtc-refresh-hid').val(\"1\"); \n \
+														$('#rtc-refresh-hid').val(\"1\"); \n \
 														$('#rtc-refresh-hid').click(); \n \
 														$('#rtc-refresh-hid').val(\"0\"); \n \
-                                                    }); \n \
+													}); \n \
 													$('#rtc-update').click(function() { \n \
-                                                        var rtc_year = $('#rtc_year').val();\n \
+														var rtc_year = $('#rtc_year').val();\n \
 														var rtc_month = $('#rtc_month').val();\n \
 														var rtc_date = $('#rtc_date').val();\n \
 														var rtc_weekday = $('#rtc_weekday').val();\n \
 														var rtc_hours = $('#rtc_hours').val();\n \
 														var rtc_minutes = $('#rtc_minutes').val();\n \
 														var rtc_seconds = $('#rtc_seconds').val();\n \
-                                                        $.ajax({ \n\
-                                                            url: '/rtc',\n \
-                                                            type: 'POST',\n \
-                                                            contentType: 'application/x-www-form-urlencoded',  \n \
-                                                            data: {\n \
-                                                                year: rtc_year, \n \
-                                                                month: rtc_month, \n \
-                                                                date: rtc_date, \n \
+														$.ajax({ \n\
+															url: '/rtc',\n \
+															type: 'POST',\n \
+															contentType: 'application/x-www-form-urlencoded',  \n \
+															data: {\n \
+																year: rtc_year, \n \
+																month: rtc_month, \n \
+																date: rtc_date, \n \
 																weekday: rtc_weekday, \n \
 																hours: rtc_hours, \n \
 																minutes: rtc_minutes, \n \
 																seconds: rtc_seconds \n \
-                                                            },\n \
+															},\n \
 															beforeSend: function() { \n \
 																if (parseInt(rtc_year) > 3000 || parseInt(rtc_year) < 1900) {\n \
 																	alert('Invalid year!');\n \
@@ -9572,20 +9572,20 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																	return false;\n \
 																}\n \
 															},\n \
-                                                            success: function(response) {\n \
-                                                                if(response.status===0){\n \
-                                                                    alert(\"update success!\");\n \
-                                                                }else{\n \
-                                                                    alert(response.message);\n \
-                                                                }\n \
-                                                                console.log('rtc settings updated successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                alert(\"udpate failed!\");\n \
-                                                                console.error('Error updating rtc settings:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+															success: function(response) {\n \
+																if(response.status===0){\n \
+																	alert(\"update success!\");\n \
+																}else{\n \
+																	alert(response.message);\n \
+																}\n \
+																console.log('rtc settings updated successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																alert(\"udpate failed!\");\n \
+																console.error('Error updating rtc settings:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#soc-refresh-hid').click(function() {\n \
 														if($('#power-on-change').val()==='1'){ //off status \n \
 															$('#soc-status').val(\"stopped\");\n \
@@ -9594,14 +9594,14 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 														if( power_on_change_countdown > 0 ){ \n \
 															return; \n \
 														} \n \
-                                                        $.ajax({\n \
+														$.ajax({\n \
 															async: false,\n \
-                                                            url: '/soc-status',\n \
-                                                            type: 'GET',\n \
+															url: '/soc-status',\n \
+															type: 'GET',\n \
 															data: {\n \
-                                                                byhand: $('#soc-refresh-hid').val(),\n \
-                                                            },\
-                                                            success: function(response) {\n \
+																byhand: $('#soc-refresh-hid').val(),\n \
+															},\
+															success: function(response) {\n \
 																if(response.status===0){ \n \
 																	if(response.data.status===\"0\"){ \n \
 																		$('#soc-status').val(\"working\");\n \
@@ -9609,18 +9609,18 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 																		$('#soc-status').val(\"stopped\");\n \
 																	} \n \
 																}\n \
-                                                                console.log('soc status refreshed successfully.');\n \
-                                                            },\n \
-                                                            error: function(xhr, status, error) {\n \
-                                                                console.error('Error refreshing soc status:', error);\n \
-                                                            }\n \
-                                                        });\n \
-                                                    });\n \
+																console.log('soc status refreshed successfully.');\n \
+															},\n \
+															error: function(xhr, status, error) {\n \
+																console.error('Error refreshing soc status:', error);\n \
+															}\n \
+														});\n \
+													});\n \
 													$('#soc-refresh').click(function() { \n \
-                                                        $('#soc-refresh-hid').val(\"1\"); \n \
+														$('#soc-refresh-hid').val(\"1\"); \n \
 														$('#soc-refresh-hid').click(); \n \
 														$('#soc-refresh-hid').val(\"0\"); \n \
-                                                    }); \n \
+													}); \n \
 													$('input[name=\"swctrl\"]').change(function() {\n \
 														toggleDipRadios($(this).val() === '1');//select button is sw and last dip-switch data is sw data \n \
 													});\n \
@@ -9650,7 +9650,7 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 													$('#pvt-info-refresh-hid').click(); \n \
 													$('#dip-switch-show-refresh-hid').click(); \n \
 													$('#dip-switch-refresh-hid').click(); \n \
-   													$('#net-work-refresh-hid').click(); \n \
+													$('#net-work-refresh-hid').click(); \n \
 													$('#board-info-som-refresh').click(); \n \
 													$('#board-info-cb-refresh').click(); \n \
 													$('#rtc-refresh-hid').click(); \n \
@@ -9664,25 +9664,25 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 													}, 1*60*1000+400); \n \
 													setInterval(function() {\n \
 														$('#pvt-info-refresh-hid').click(); \n \
-   														$('#net-work-refresh-hid').click(); \n \
+														$('#net-work-refresh-hid').click(); \n \
 													}, 3*60*1000+700); \n \
 													setInterval(function() {\n \
 														$('#power-on-refresh-hid').click(); \n \
 														$('#soc-refresh-hid').click(); \n \
 													}, 5*1000); \n \
-                                                });\n\
-                                            </script>\n \
-                                            <style> \
-                                            .logout-form-wrapper { \
-                                                position: absolute; \
-                                                top: 10px; \
-                                                right: 10px; \
-                                            } \
+												});\n\
+											</script>\n \
+											<style> \
+											.logout-form-wrapper { \
+												position: absolute; \
+												top: 10px; \
+												right: 10px; \
+											} \
 											.modify-account-form-wrapper { \
-                                                position: absolute; \
-                                                top: 10px; \
-                                                right: 50px; \
-                                            } \
+												position: absolute; \
+												top: 10px; \
+												right: 50px; \
+											} \
 											.network-row { \
 												display: flex; \
 												margin-bottom: 10px; \
@@ -9709,17 +9709,17 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 											.option-row label {\
 												margin-right: 20px;\
 											}\
-                                            </style> \
-                                    </head> \
-                                    <body> \
+											</style> \
+									</head> \
+									<body> \
 										<div class=\"modify-account-form-wrapper\"> \
 											<button><a href=\"/modify_account.html\">ModifyAccont</a></button> \
-                                        </div> \
-                                        <div class=\"logout-form-wrapper\"> \
+										</div> \
+										<div class=\"logout-form-wrapper\"> \
 											<form class=\"logout-form\" action=\"/logout\" id=\"logoutForm\" method=\"post\"> \
 												<button type=\"submit\">Exit</button> \
 											</form> \
-                                        </div> \
+										</div> \
 										<div> \
 											<h3>Board Information</h3> \
 											<h4>SOM Info</h4> \
@@ -9757,7 +9757,7 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 											</div> \
 											<button id=\"board-info-cb-refresh\" >refresh</button> \
 										</div> \
-                                       <h3>Machine Status</h3> \
+										<h3>Machine Status</h3> \
 										<div class=\"power-status\"> \
 											<div class=\"network-row\"> \
 											<label id=\"power-status-label\">Power Status :</label> <button id=\"power-on-change\" disabled>loading,,,</button>   <br> \
@@ -9791,22 +9791,22 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 											<button id=\"power-consum-refresh\">refresh</button> <br> \
 											<button id=\"power-consum-refresh-hid\" value=\"0\" style=\"display:none;\" >refresh</button> \
 										</div> \
-                                        <div class=\"pvt-info\" > \
-                                            <h3>PVT info</h3> \
+										<div class=\"pvt-info\" > \
+											<h3>PVT info</h3> \
 											<div class=\"network-row\"> \
-                                            <label>CPU Temperature:</label> <input type=\"text\" id=\"cpu_temp\" value=\"0\" style=\"width: 60px;\" disabled><span>°C</span><br> \
+											<label>CPU Temperature:</label> <input type=\"text\" id=\"cpu_temp\" value=\"0\" style=\"width: 60px;\" disabled><span>°C</span><br> \
 											</div> \
 											<div class=\"network-row\"> \
-                                            <label>NPU Temperature:</label> <input type=\"text\" id=\"npu_temp\" value=\"0\" style=\"width: 60px;\" disabled><span>°C</span><br> \
+											<label>NPU Temperature:</label> <input type=\"text\" id=\"npu_temp\" value=\"0\" style=\"width: 60px;\" disabled><span>°C</span><br> \
 											</div> \
 											<div class=\"network-row\"> \
-                                            <label>Fan Speed      :</label> <input type=\"text\" id=\"fan_speed\" value=\"0\" style=\"width: 60px;\" disabled><span>RPM</span><br> \
+											<label>Fan Speed      :</label> <input type=\"text\" id=\"fan_speed\" value=\"0\" style=\"width: 60px;\" disabled><span>RPM</span><br> \
 											</div> \
-                                            <button id=\"pvt-info-refresh\" >refresh</button> \
+											<button id=\"pvt-info-refresh\" >refresh</button> \
 											<button id=\"pvt-info-refresh-hid\" value=\"0\" style=\"display:none;\">refresh</button> \
-                                        </div> \
-										 <div class=\"dip-switch\" > \
-                                            <h3>DIP Switch</h3> \
+										</div> \
+										<div class=\"dip-switch\" > \
+											<h3>DIP Switch</h3> \
 											<label  style=\"font-family: 'Arial Black', sans-serif; font-weight: bold;\">&nbsp;&nbsp;Current Status:</label> \
 											<div  class=\"network-row\"> \
 												<label>Software/Hardware Ctrl:</label> \
@@ -9839,7 +9839,7 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 												<input type=\"radio\" name=\"dip01-show\" value=\"1\" id=\"dip01-show-false\" disabled>\
 												<label for=\"dip01-show-false\">OFF</label>\
 											</div>\
-                                            <button id=\"dip-switch-show-refresh\">refresh</button> \
+											<button id=\"dip-switch-show-refresh\">refresh</button> \
 											<button id=\"dip-switch-show-refresh-hid\" value=\"0\" style=\"display:none;\">refresh</button> \
 											<br> \
 											<label>====================================</label> \
@@ -9878,26 +9878,26 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 											</div>\
 											<button id=\"dip-switch-update\">update</button> \
 											<button id=\"dip-switch-refresh-hid\" value=\"0\" style=\"display:none;\">refresh</button> \
-                                        </div> \
-                                        <div class=\"net-work\" > \
-                                            <h3>Network System</h3> \
-											 <div class=\"network-row\"> \
+										</div> \
+										<div class=\"net-work\" > \
+											<h3>Network System</h3> \
+											<div class=\"network-row\"> \
 											<label>Mac Address:</label> <input type=\"text\" id=\"macaddr\" value=\"0\" style=\"width: 180px;\"> <br> \
 											</div>  \
-											 <div class=\"network-row\"> \
-                                            <label> IP Address :</label> <input type=\"text\" id=\"ipaddr\" value=\"0\" style=\"width: 180px;\"> <br> \
+											<div class=\"network-row\"> \
+											<label> IP Address :</label> <input type=\"text\" id=\"ipaddr\" value=\"0\" style=\"width: 180px;\"> <br> \
 											</div> \
-											 <div class=\"network-row\"> \
-                                            <label>Gateway :</label> <input type=\"text\" id=\"gateway\" value=\"0\" style=\"width: 180px;\"> <br> \
+											<div class=\"network-row\"> \
+											<label>Gateway :</label> <input type=\"text\" id=\"gateway\" value=\"0\" style=\"width: 180px;\"> <br> \
+											</div> \
+											<div class=\"network-row\"> \
+											<label>Subnet Mask:</label> <input type=\"text\" id=\"subnetwork\" value=\"0\" style=\"width: 180px;\"> <br> \
 											</div> \
-											 <div class=\"network-row\"> \
-                                            <label>Subnet Mask:</label> <input type=\"text\" id=\"subnetwork\" value=\"0\" style=\"width: 180px;\"> <br> \
-											 </div> \
-                                            <button id=\"net-work-refresh\">refresh</button> <button id=\"net-work-update\">update</button> \
+											<button id=\"net-work-refresh\">refresh</button> <button id=\"net-work-update\">update</button> \
 											<button id=\"net-work-refresh-hid\" value=\"0\" style=\"display:none;\">refresh</button> \
-                                        </div> \
+										</div> \
 										<div class=\"rtc\" > \
-                                            <h3>RTC System</h3> \
+											<h3>RTC System</h3> \
 											<div class=\"network-row\"> \
 												<label>Datetime:</label> <input type=\"text\" id=\"rtc_datetime\" value=\"0\" style=\"width: 180px;\" disabled> <br> \
 											</div>  \
@@ -9905,36 +9905,36 @@ const unsigned char info_html[] ="<html lang=\"en\"> \
 												<label>Year:</label> <input type=\"text\" id=\"rtc_year\" value=\"0\" style=\"width: 100px;\"> <br> \
 											</div>  \
 											<div class=\"network-row\"> \
-                                           		<label>Month:</label> <input type=\"text\" id=\"rtc_month\" value=\"0\" style=\"width: 100px;\"> <br> \
+												<label>Month:</label> <input type=\"text\" id=\"rtc_month\" value=\"0\" style=\"width: 100px;\"> <br> \
 											</div> \
 											<div class=\"network-row\"> \
-                                            	<label>Date:</label> <input type=\"text\" id=\"rtc_date\" value=\"0\" style=\"width: 100px;\"> <br> \
+												<label>Date:</label> <input type=\"text\" id=\"rtc_date\" value=\"0\" style=\"width: 100px;\"> <br> \
 											</div> \
 											<div class=\"network-row\"> \
-                                            	<label>WeekDay:</label> <input type=\"text\" id=\"rtc_weekday\" value=\"0\" style=\"width: 100px;\"> <br> \
+												<label>WeekDay:</label> <input type=\"text\" id=\"rtc_weekday\" value=\"0\" style=\"width: 100px;\"> <br> \
 											</div> \
 											<div class=\"network-row\"> \
-                                            	<label>Hours:</label> <input type=\"text\" id=\"rtc_hours\" value=\"0\" style=\"width: 100px;\"> <br> \
+												<label>Hours:</label> <input type=\"text\" id=\"rtc_hours\" value=\"0\" style=\"width: 100px;\"> <br> \
 											</div> \
 											<div class=\"network-row\"> \
-                                            	<label>Minutes:</label> <input type=\"text\" id=\"rtc_minutes\" value=\"0\" style=\"width: 100px;\"> <br> \
+												<label>Minutes:</label> <input type=\"text\" id=\"rtc_minutes\" value=\"0\" style=\"width: 100px;\"> <br> \
 											</div> \
 											<div class=\"network-row\"> \
-                                            	<label>Seconds:</label> <input type=\"text\" id=\"rtc_seconds\" value=\"0\" style=\"width: 100px;\"> <br> \
+												<label>Seconds:</label> <input type=\"text\" id=\"rtc_seconds\" value=\"0\" style=\"width: 100px;\"> <br> \
 											</div> \
-                                            <button id=\"rtc-refresh\">refresh</button> <button id=\"rtc-update\">update</button> \
+											<button id=\"rtc-refresh\">refresh</button> <button id=\"rtc-update\">update</button> \
 											<button id=\"rtc-refresh-hid\" value=\"0\" style=\"display:none;\">refresh</button> \
-                                        </div> \
-                                    </body> \
-                                    </html> ";
+										</div> \
+									</body> \
+									</html> ";
 
 
 const unsigned char modify_account_html[] ="<html lang=\"zh\"> \
-                                    <head> \
-                                        <meta charset=\"UTF-8\"> \
-                                        <title>Account modify</title> \
+									<head> \
+										<meta charset=\"UTF-8\"> \
+										<title>Account modify</title> \
 										<script src=\"/jquery.min.js\"></script> \
- 										<script> \n \
+										<script> \n \
 											$(document).ready(function() { \n \
 												$('#modifyForm').submit(function(event) { \n \
 													event.preventDefault();  \n \
@@ -9993,17 +9993,17 @@ const unsigned char modify_account_html[] ="<html lang=\"zh\"> \
 												}); \n \
 											}); \n \
 										</script> \n \
-										 <style> \
-                                            .logout-form-wrapper { \
-                                                position: absolute; \
-                                                top: 10px; \
-                                                right: 10px; \
-                                            } \
+										<style> \
+											.logout-form-wrapper { \
+												position: absolute; \
+												top: 10px; \
+												right: 10px; \
+											} \
 											.info-form-wrapper { \
-                                                position: absolute; \
-                                                top: 10px; \
-                                                right: 50px; \
-                                            } \
+												position: absolute; \
+												top: 10px; \
+												right: 50px; \
+											} \
 											.network-row { \
 												display: flex; \
 												margin-bottom: 10px; \
@@ -10012,33 +10012,33 @@ const unsigned char modify_account_html[] ="<html lang=\"zh\"> \
 											label { \
 												width: 200px;  \
 											} \
-                                            </style> \
-                                    </head> \
-                                    <body> \
+											</style> \
+									</head> \
+									<body> \
 										<div class=\"info-form-wrapper\"> \
 											<button><a href=\"/info.html\">Info</a></button> \
-                                        </div> \
-                                        <div class=\"logout-form-wrapper\"> \
+										</div> \
+										<div class=\"logout-form-wrapper\"> \
 											<form class=\"logout-form\" action=\"/logout\" id=\"logoutForm\" method=\"post\"> \
 												<button type=\"submit\">Exit</button> \
 											</form> \
-                                        </div> \
+										</div> \
 										<div style=\"display: flex; flex-direction: column; align-items: center;\"> \
-                                        <h2>Account modify</h2> \
-                                        <form action=\"/modify_account\" id=\"modifyForm\" method=\"POST\"  > \
+										<h2>Account modify</h2> \
+										<form action=\"/modify_account\" id=\"modifyForm\" method=\"POST\"  > \
 											<div class=\"network-row\"> \
 												<label for=\"username\">Username:</label> <input type=\"text\" id=\"username\" name=\"username\"  required> \
 											</div> \
 											<div class=\"network-row\"> \
 												<label for=\"password\">Password:</label>  <input type=\"password\" id=\"password\" name=\"password\" required> \
 											</div> \
-                                            <div> \
-                                                <button type=\"submit\">Update</button> \
-                                            </div> \
-                                        </form> \
+											<div> \
+												<button type=\"submit\">Update</button> \
+											</div> \
+										</form> \
 										</div> \
-                                    </body> \
-                                    </html> ";
+									</body> \
+									</html> ";
 
 const char *json_header = "HTTP/1.1 200 OK\r\n"
 						"Content-Type: application/json\r\n"
@@ -10051,96 +10051,96 @@ const char *json_header_withcookie = "HTTP/1.1 200 OK\r\n"
 						"Content-Length: %d\r\n\r\n";
 
 char* concatenate_strings(const char* str1, const char* str2) {
-    int length = strlen(str1) + strlen(str2) + 1; // +1 for the null terminator
-    char* new_str = pvPortMalloc(length);
-    if (new_str == NULL) {
-        web_debug("Memory allocation failed\n");
-        exit(1);
-    }
-
-    strcpy(new_str, str1);
-    strcat(new_str, str2);
-    return new_str;
+	int length = strlen(str1) + strlen(str2) + 1; // +1 for the null terminator
+	char* new_str = pvPortMalloc(length);
+	if (new_str == NULL) {
+		web_debug("Memory allocation failed\n");
+		exit(1);
+	}
+
+	strcpy(new_str, str1);
+	strcat(new_str, str2);
+	return new_str;
 }
 
 void send_redirect(struct netconn *conn, const char *location,const char* cookies) {
-    char header[BUF_SIZE];
+	char header[BUF_SIZE];
 	LWIP_ASSERT("strlen(cookies)<80",strlen(cookies)<80);
 	LWIP_ASSERT("strlen(location)<30",strlen(location)<30);
-    if(cookies!=NULL && strlen(cookies)>0){
-        sprintf(header,
-                "HTTP/1.1 302 Found\r\n"
-                "Location: %.30s\r\n"
-                "Content-Length: 0\r\n"
-                "%.80s"
-                "Connection: close\r\n\r\n",
-                location,cookies);
-    }else{
-     sprintf(header,
-                "HTTP/1.1 302 Found\r\n"
-                "Location: %.30s\r\n"
-                "Content-Length: 0\r\n"
-                "Connection: close\r\n\r\n",
-                location);
-
-    }
-    web_debug("header: %d  %s \n",strlen(header),header);
-    netconn_write(conn, header, strlen(header), NETCONN_COPY);
+	if(cookies!=NULL && strlen(cookies)>0){
+		sprintf(header,
+				"HTTP/1.1 302 Found\r\n"
+				"Location: %.30s\r\n"
+				"Content-Length: 0\r\n"
+				"%.80s"
+				"Connection: close\r\n\r\n",
+				location,cookies);
+	}else{
+	sprintf(header,
+				"HTTP/1.1 302 Found\r\n"
+				"Location: %.30s\r\n"
+				"Content-Length: 0\r\n"
+				"Connection: close\r\n\r\n",
+				location);
+
+	}
+	web_debug("header: %d  %s \n",strlen(header),header);
+	netconn_write(conn, header, strlen(header), NETCONN_COPY);
 }
 
 err_t send_large_data(struct netconn *conn, const char *data, unsigned int length) {
-    err_t result = ERR_OK;
-    unsigned int offset = 0;
+	err_t result = ERR_OK;
+	unsigned int offset = 0;
 
-    while (offset < length) {
-        unsigned int chunk_size = CHUNK_SIZE;
-        if (offset + CHUNK_SIZE > length) {
-            chunk_size = length - offset;
-        }
+	while (offset < length) {
+		unsigned int chunk_size = CHUNK_SIZE;
+		if (offset + CHUNK_SIZE > length) {
+			chunk_size = length - offset;
+		}
 
 
-        result = netconn_write(conn, data + offset, chunk_size, NETCONN_COPY);
+		result = netconn_write(conn, data + offset, chunk_size, NETCONN_COPY);
 		// web_debug("offset:%d chunk_size:%d \n" ,offset,chunk_size);
 
-        if (result != ERR_OK) {
-            break;
-        }
+		if (result != ERR_OK) {
+			break;
+		}
 
-        offset += chunk_size;
-    }
+		offset += chunk_size;
+	}
 
-    return result;
+	return result;
 }
 
 void send_response_content(struct netconn *conn,const char* cookies,const char* html_content ){
-    char* header_tmp=NULL;
-    char* header=NULL;
+	char* header_tmp=NULL;
+	char* header=NULL;
 	const char http_html_hdr_patt[] = "HTTP/1.1 200 OK\r\nConnection: close\r\nContent-Length: %d\r\nContent-type: text/html\r\n";
 
 	char header_full[BUF_SIZE_256]={0};
 
-    if(cookies!=NULL && strlen(cookies)>0){
-        header_tmp = concatenate_strings(http_html_hdr_patt,cookies);
-        header = concatenate_strings(header_tmp,"\r\n");
-        vPortFree(header_tmp);
-    }else{
-        header = concatenate_strings(http_html_hdr_patt,"\r\n");
-    }
+	if(cookies!=NULL && strlen(cookies)>0){
+		header_tmp = concatenate_strings(http_html_hdr_patt,cookies);
+		header = concatenate_strings(header_tmp,"\r\n");
+		vPortFree(header_tmp);
+	}else{
+		header = concatenate_strings(http_html_hdr_patt,"\r\n");
+	}
 
 	sprintf(header_full, header,  strlen(html_content));
 
-    web_debug("send_response header size: %d \n",strlen(header_full));
+	web_debug("send_response header size: %d \n",strlen(header_full));
 	netconn_write(conn, header_full, strlen(header_full), NETCONN_COPY);
 	send_large_data(conn, html_content,  strlen(html_content));
 	web_debug("send_response html_content end \n");
 
-    vPortFree(header);
+	vPortFree(header);
 }
 void send_response_200(struct netconn *conn) {
 	const char http_html_200[] =  "HTTP/1.1 200 OK\r\n"\
-             "Content-Type: text/html\r\n"\
-			 "Content-Length: 0\r\n"\
-             "Connection: close\r\n\r\n"  ;
+			"Content-Type: text/html\r\n"\
+			"Content-Length: 0\r\n"\
+			"Connection: close\r\n\r\n"  ;
    netconn_write(conn, http_html_200, sizeof(http_html_200), NETCONN_COPY);
 }
 
@@ -10148,61 +10148,61 @@ void send_response_200(struct netconn *conn) {
 // ------------------------ parse params  ---------------------
 
 typedef struct kv_pair {
-    char *key;
-    char *value;
-    struct kv_pair *next;
+	char *key;
+	char *value;
+	struct kv_pair *next;
 } kv_pair;
 
 typedef struct {
-    kv_pair *head;
-    size_t size;
+	kv_pair *head;
+	size_t size;
 } kv_map;
 
 kv_pair* create_kv_pair(const char *key, const char *value) {
-    kv_pair *new_pair = (kv_pair *)pvPortMalloc(sizeof(kv_pair));
-    if (new_pair == NULL) {
-        return NULL;
-    }
-
-    new_pair->key = strdup(key);
-    new_pair->value = strdup(value);
-    new_pair->next = NULL;
-    return new_pair;
+	kv_pair *new_pair = (kv_pair *)pvPortMalloc(sizeof(kv_pair));
+	if (new_pair == NULL) {
+		return NULL;
+	}
+
+	new_pair->key = strdup(key);
+	new_pair->value = strdup(value);
+	new_pair->next = NULL;
+	return new_pair;
 }
 
 void free_kv_map(kv_map *map) {
-    kv_pair *current = map->head;
-    while (current != NULL) {
-        kv_pair *next = current->next;
-        free(current->key);
-        free(current->value);
-        vPortFree(current);
-        current = next;
-    }
-    map->head = NULL;
-    map->size = 0;
+	kv_pair *current = map->head;
+	while (current != NULL) {
+		kv_pair *next = current->next;
+		free(current->key);
+		free(current->value);
+		vPortFree(current);
+		current = next;
+	}
+	map->head = NULL;
+	map->size = 0;
 }
 
 kv_map parse_get_params(const char *query) {
-    kv_map params = {NULL, 0};
-    char *query_dup = strdup(query);
-    char *token = strtok(query_dup, "&");
-
-    while (token) {
-        char *equal_sign = strchr(token, '=');
-        if (equal_sign) {
-            *equal_sign = '\0';
-            kv_pair *new_pair = create_kv_pair(token, equal_sign + 1);
-            if (new_pair) {
-                new_pair->next = params.head;
-                params.head = new_pair;
-                params.size++;
-            }
-        }
-        token = strtok(NULL, "&");
-    }
-    free(query_dup);
-    return params;
+	kv_map params = {NULL, 0};
+	char *query_dup = strdup(query);
+	char *token = strtok(query_dup, "&");
+
+	while (token) {
+		char *equal_sign = strchr(token, '=');
+		if (equal_sign) {
+			*equal_sign = '\0';
+			kv_pair *new_pair = create_kv_pair(token, equal_sign + 1);
+			if (new_pair) {
+				new_pair->next = params.head;
+				params.head = new_pair;
+				params.size++;
+			}
+		}
+		token = strtok(NULL, "&");
+	}
+	free(query_dup);
+	return params;
 }
 // ------------------------ parse params  end ---------------------
 
@@ -10211,17 +10211,17 @@ kv_map parse_get_params(const char *query) {
 
 
 void parse_cookies(const char* request, char* cookies) {
-    const char* cookie_header = "Cookie: ";
-    const char* start = strstr(request, cookie_header);
-    if (start) {
-        start += strlen(cookie_header);
-        const char* end = strstr(start, "\r\n");
-        if (end) {
-            size_t len = end - start;
-            strncpy(cookies, start, len);
-            cookies[len] = '\0';
-        }
-    }
+	const char* cookie_header = "Cookie: ";
+	const char* start = strstr(request, cookie_header);
+	if (start) {
+		start += strlen(cookie_header);
+		const char* end = strstr(start, "\r\n");
+		if (end) {
+			size_t len = end - start;
+			strncpy(cookies, start, len);
+			cookies[len] = '\0';
+		}
+	}
 }
 // ------------------------ cookie end ---------------------
 
@@ -10231,23 +10231,23 @@ void parse_cookies(const char* request, char* cookies) {
 
 
 void generate_session_id(char *session_id, int length) {
-    const char charset[] = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
-    if (length > 0) {
-        srand(HAL_GetTick());
-        for (int i = 0; i < length - 1; ++i) {
-            int key = rand() % (int)(sizeof(charset) - 1);
-            session_id[i] = charset[key];
-        }
-        session_id[length - 1] = '\0';
-    }
+	const char charset[] = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
+	if (length > 0) {
+		srand(HAL_GetTick());
+		for (int i = 0; i < length - 1; ++i) {
+			int key = rand() % (int)(sizeof(charset) - 1);
+			session_id[i] = charset[key];
+		}
+		session_id[length - 1] = '\0';
+	}
 }
 
 
 typedef struct Session {
-    char session_id[SESSION_ID_LENGTH+1];// +1 for \0
-    char session_data[SESSION_DATA_LENGTH+1];
+	char session_id[SESSION_ID_LENGTH+1];// +1 for \0
+	char session_data[SESSION_DATA_LENGTH+1];
 	uint32_t tick_value;//HAL_GetTick(),ms
-    struct Session *next;
+	struct Session *next;
 } Session;
 
 
@@ -10256,92 +10256,92 @@ Session head_session = {"head_session","head_session",0,NULL};
 int delete_timeout_session() {//return del count;
 	uint32_t current_time_tick=HAL_GetTick();
 	int del_count=0;
-    Session *current = &head_session;
-    while (current->next != NULL) {//handle node:current->next
-        if (current_time_tick - current->next->tick_value > MAX_AGE*1000) {
-            Session *to_delete = current->next;
-            current->next = current->next->next;//delete current->next from node list
-            vPortFree(to_delete);//free mem
+	Session *current = &head_session;
+	while (current->next != NULL) {//handle node:current->next
+		if (current_time_tick - current->next->tick_value > MAX_AGE*1000) {
+			Session *to_delete = current->next;
+			current->next = current->next->next;//delete current->next from node list
+			vPortFree(to_delete);//free mem
 			del_count++;
-        }else{
+		}else{
 			current = current->next;
 		}
-    }
-    return del_count;
+	}
+	return del_count;
 }
 
 Session* create_session(const char *id, const char *data) {
-    Session *new_session = (Session *)pvPortMalloc(sizeof(Session));
-    if (new_session) {
-        strncpy(new_session->session_id, id, sizeof(new_session->session_id) - 1);
-        new_session->session_id[sizeof(new_session->session_id) - 1] = '\0';
-        strncpy(new_session->session_data, data, sizeof(new_session->session_data) - 1);
-        new_session->session_data[sizeof(new_session->session_data) - 1] = '\0';
+	Session *new_session = (Session *)pvPortMalloc(sizeof(Session));
+	if (new_session) {
+		strncpy(new_session->session_id, id, sizeof(new_session->session_id) - 1);
+		new_session->session_id[sizeof(new_session->session_id) - 1] = '\0';
+		strncpy(new_session->session_data, data, sizeof(new_session->session_data) - 1);
+		new_session->session_data[sizeof(new_session->session_data) - 1] = '\0';
 		new_session->tick_value=HAL_GetTick();
-        new_session->next = NULL;
-    }
-    return new_session;
+		new_session->next = NULL;
+	}
+	return new_session;
 }
 
 void add_session(Session *session) {
-    session->next = head_session.next;
+	session->next = head_session.next;
 	head_session.next=session;
 }
 
 Session* find_session(const char *id) {
-    Session *current = head_session.next;
-    while (current != NULL) {
-        if (strcmp(current->session_id, id) == 0) {
-            return current;
-        }
-        current = current->next;
-    }
-    return NULL;
+	Session *current = head_session.next;
+	while (current != NULL) {
+		if (strcmp(current->session_id, id) == 0) {
+			return current;
+		}
+		current = current->next;
+	}
+	return NULL;
 }
 void print_session() {
 	web_debug("sessons: \n");
-    Session *current = head_session.next;
-    while (current != NULL) {
+	Session *current = head_session.next;
+	while (current != NULL) {
 		web_debug("current->session_id:%s current->data:%s tick_value:%d\n",current->session_id,current->session_data,current->tick_value);
-        current = current->next;
-    }
-    return ;
+		current = current->next;
+	}
+	return ;
 }
 
 int update_session(const char *id, const char *data) {
-    Session *session = find_session(id);
-    if (session) {
-        strncpy(session->session_data, data, sizeof(session->session_data) - 1);
-        session->session_data[sizeof(session->session_data) - 1] = '\0';
-        return 1;
-    }
-    return 0;
+	Session *session = find_session(id);
+	if (session) {
+		strncpy(session->session_data, data, sizeof(session->session_data) - 1);
+		session->session_data[sizeof(session->session_data) - 1] = '\0';
+		return 1;
+	}
+	return 0;
 }
 
 int delete_session(const char *id) {
 	int del_count=0;
-    Session *current = &head_session;
-    while (current->next != NULL) {//handle node:current->next
-        if (strcmp(current->next->session_id, id) == 0) {
-            Session *to_delete = current->next;
-            current->next = current->next->next;//delete current->next from node list
-            vPortFree(to_delete);//free mem
+	Session *current = &head_session;
+	while (current->next != NULL) {//handle node:current->next
+		if (strcmp(current->next->session_id, id) == 0) {
+			Session *to_delete = current->next;
+			current->next = current->next->next;//delete current->next from node list
+			vPortFree(to_delete);//free mem
 			del_count++;
-        }else{
+		}else{
 			current = current->next;
 		}
-    }
-    return del_count;
+	}
+	return del_count;
 }
 
 void clear_sessions() {
-    Session *current = &head_session;
-    while (current->next != NULL) {
-        Session *to_delete = current->next;
-        current->next = current->next->next;
-        vPortFree(to_delete);
-    }
-    head_session.next = NULL;
+	Session *current = &head_session;
+	while (current->next != NULL) {
+		Session *to_delete = current->next;
+		current->next = current->next->next;
+		vPortFree(to_delete);
+	}
+	head_session.next = NULL;
 }
 
 // ------------------------ session end ---------------------
@@ -10349,18 +10349,18 @@ void clear_sessions() {
 // ------------------------ eeprom username password --------------
 
 void parseCredentials(const char *readBuffer, char *username, char *password) {
-    char buffer[EEPROM_USERNAME_PASSWORD_BUFFER_SIZE];
-    strncpy(buffer, readBuffer, EEPROM_USERNAME_PASSWORD_BUFFER_SIZE);
-    buffer[EEPROM_USERNAME_PASSWORD_BUFFER_SIZE - 1] = '\0';
-
-    char *token = strtok(buffer, ",");
-    if (token != NULL) {
-        strncpy(username, token, EEPROM_USERNAME_PASSWORD_BUFFER_SIZE);
-        token = strtok(NULL, ",");
-        if (token != NULL) {
-            strncpy(password, token, EEPROM_USERNAME_PASSWORD_BUFFER_SIZE);
-        }
-    }
+	char buffer[EEPROM_USERNAME_PASSWORD_BUFFER_SIZE];
+	strncpy(buffer, readBuffer, EEPROM_USERNAME_PASSWORD_BUFFER_SIZE);
+	buffer[EEPROM_USERNAME_PASSWORD_BUFFER_SIZE - 1] = '\0';
+
+	char *token = strtok(buffer, ",");
+	if (token != NULL) {
+		strncpy(username, token, EEPROM_USERNAME_PASSWORD_BUFFER_SIZE);
+		token = strtok(NULL, ",");
+		if (token != NULL) {
+			strncpy(password, token, EEPROM_USERNAME_PASSWORD_BUFFER_SIZE);
+		}
+	}
 }
 
 // 0 succ,1 fail
@@ -10379,9 +10379,9 @@ int validate_credentials(const char *username, const char *password) {
 	LWIP_ASSERT("username!=NULL&&password!=NULL",username!=NULL&&password!=NULL);
 	char sys_username[EEPROM_USERNAME_PASSWORD_BUFFER_SIZE]="admin";
 	char sys_password[EEPROM_USERNAME_PASSWORD_BUFFER_SIZE]="123456";
-    get_sys_username_password(sys_username,sys_password);
+	get_sys_username_password(sys_username,sys_password);
 	LWIP_ASSERT("sys_username!=NULL&&sys_password!=NULL",sys_username!=NULL&&sys_password!=NULL);
-    return (strcmp(username, sys_username) == 0 && strcmp(password, sys_password) == 0)?0:1;
+	return (strcmp(username, sys_username) == 0 && strcmp(password, sys_password) == 0)?0:1;
 }
 
 
@@ -10389,26 +10389,26 @@ int validate_credentials(const char *username, const char *password) {
 // ------------------------ eeprom username password end --------------
 
 const char* process_header(const char *header) {
-    const char *pos = header;
-    const char *end;
-    char line[1024];
-
-    while ((end = strstr(pos, "\r\n")) != NULL) {
-        size_t len = end - pos;
-        if (len > sizeof(line) - 1) len = sizeof(line) - 1;
-        memcpy(line, pos, len);
-        line[len] = '\0';
-
-        pos = end + 2; // skip "\r\n"
-
-        // check header（即"\r\n\r\n"）
-        if (*pos == '\r' && *(pos + 1) == '\n') {
-            // web_debug("End of header.\n");
-            return pos + 2;
-        }
-    }
+	const char *pos = header;
+	const char *end;
+	char line[1024];
+
+	while ((end = strstr(pos, "\r\n")) != NULL) {
+		size_t len = end - pos;
+		if (len > sizeof(line) - 1) len = sizeof(line) - 1;
+		memcpy(line, pos, len);
+		line[len] = '\0';
+
+		pos = end + 2; // skip "\r\n"
+
+		// check header（即"\r\n\r\n"）
+		if (*pos == '\r' && *(pos + 1) == '\n') {
+			// web_debug("End of header.\n");
+			return pos + 2;
+		}
+	}
 	// web_debug("can't find rnrn pos-header:%d .\n",pos-header);
-    return NULL; // not found "\r\n\r\n"，return NULL
+	return NULL; // not found "\r\n\r\n"，return NULL
 }
 
 
@@ -10416,11 +10416,11 @@ static bool led_on = FALSE;
 
 
 void unescape_colon(char *str) {
-    char *pos;
-    while ((pos = strstr(str, "%3A")) != NULL) {
-        *pos = ':';
-        memmove(pos + 1, pos + 3, strlen(pos + 3) + 1);
-    }
+	char *pos;
+	while ((pos = strstr(str, "%3A")) != NULL) {
+		*pos = ':';
+		memmove(pos + 1, pos + 3, strlen(pos + 3) + 1);
+	}
 }
 
 //1:powerON,0:powerOFF
@@ -10647,7 +10647,7 @@ int get_rtcinfo(RTCInfo *rtcInfo)
 	rtcInfo->hours = time.Hours;
 	rtcInfo->minutes = time.Minutes;
 	rtcInfo->seconds = time.Seconds;
-    return 0;
+	return 0;
 }
 
 int set_rtcinfo(RTCInfo rtcInfo){
@@ -10671,149 +10671,149 @@ int get_soc_status()
 	return get_som_power_state() == SOM_POWER_ON ? (SOM_DAEMON_ON == get_som_daemon_state() ? 0 : 1): 1 ;
 }
 
- /** Serve one HTTP connection accepted in the http thread */
- static void
- http_server_netconn_serve(struct netconn *conn)
- {
-     struct netbuf *inbuf;
-     char *buf;
-     u16_t buflen;
-     err_t err;
-
-     err = netconn_recv(conn, &inbuf);
-    //  web_debug("http_server_netconn_serve after:netconn_recv \n");
-    if (err == ERR_OK)
-    {
-        netbuf_data(inbuf, (void**)&buf, &buflen);
-
-        // printf(" ############### buf: ##############\n");
+/** Serve one HTTP connection accepted in the http thread */
+static void
+http_server_netconn_serve(struct netconn *conn)
+{
+	struct netbuf *inbuf;
+	char *buf;
+	u16_t buflen;
+	err_t err;
+
+	err = netconn_recv(conn, &inbuf);
+	// web_debug("http_server_netconn_serve after:netconn_recv \n");
+	if (err == ERR_OK)
+	{
+		netbuf_data(inbuf, (void**)&buf, &buflen);
+
+		// printf(" ############### buf: ##############\n");
 		// printf("sizeof(buf):%d strlen(buf):%d \n",sizeof(buf),strlen(buf));
-        // for (int i = 0; i < strlen(buf); i++) {
-        //     printf("%x(%c) ", buf[i],buf[i]);
+		// for (int i = 0; i < strlen(buf); i++) {
+		// 	printf("%x(%c) ", buf[i],buf[i]);
 		// 	if(i%16==0){
 		// 		printf("\n");
 		// 	}
-        // }
-        // printf("\n");
+		// }
+		// printf("\n");
 
-        char *buf_copy;
-        buf_copy = strdup(buf);
+		char *buf_copy;
+		buf_copy = strdup(buf);
 
-        // parse get ,cookies
-        char *method = strtok(buf_copy, " ");
-        char *url = strtok(NULL, " ");
-        char *version = strtok(NULL, "\r\n");
+		// parse get ,cookies
+		char *method = strtok(buf_copy, " ");
+		char *url = strtok(NULL, " ");
+		char *version = strtok(NULL, "\r\n");
 
-        char cookies[256] = {0};
-        parse_cookies(buf, cookies);
+		char cookies[256] = {0};
+		parse_cookies(buf, cookies);
 
-        // parse cookie ,session sid
-        char *found_session_user_name=NULL;
-        char *sidValue = NULL;
+		// parse cookie ,session sid
+		char *found_session_user_name=NULL;
+		char *sidValue = NULL;
 		Session *found_session=NULL;
 		char *cookies_copy=NULL;
-        if (cookies != NULL) {
-            // web_debug("\t session \n");
-            // Session *current = session_list;
-            // while (current != NULL) {
-            //     web_debug("%s %s\n",current->session_id,current->session_data);
-            //     current = current->next;
-            // }
+		if (cookies != NULL) {
+			// web_debug("\t session \n");
+			// Session *current = session_list;
+			// while (current != NULL) {
+			// 	web_debug("%s %s\n",current->session_id,current->session_data);
+			// 	current = current->next;
+			// }
 			// print_session();
 
-            cookies_copy=strdup(cookies);
-            char *token = strtok(cookies_copy, "; ");
-//			printf("cookies_copy:%s\n",cookies_copy);
-            while (token != NULL) {
-                if (strncmp(token, "sid=",4) == 0) {
-                    sidValue = token + 4;
-//					printf("## sidValue:%s\n",sidValue);
-                    break;
-                }
-                token = strtok(NULL, "; ");
-            }
-            if (sidValue != NULL) {
-                web_debug("sidValue : %s\n", sidValue);
-                found_session = find_session(sidValue);
-                if (found_session) {
-                    found_session_user_name=strdup(found_session->session_data);
-                }
-            }
-
-        }
-
-        char resp_cookies[BUF_SIZE_256] = {0};
-
-        if (method && url && version && strcmp(method, "GET") == 0) {
-            char *path = strtok(url, "?");
-            char *query = strtok(NULL, "?");
+			cookies_copy=strdup(cookies);
+			char *token = strtok(cookies_copy, "; ");
+			// printf("cookies_copy:%s\n",cookies_copy);
+			while (token != NULL) {
+				if (strncmp(token, "sid=",4) == 0) {
+					sidValue = token + 4;
+					// printf("## sidValue:%s\n",sidValue);
+					break;
+				}
+				token = strtok(NULL, "; ");
+			}
+			if (sidValue != NULL) {
+				web_debug("sidValue : %s\n", sidValue);
+				found_session = find_session(sidValue);
+				if (found_session) {
+					found_session_user_name=strdup(found_session->session_data);
+				}
+			}
+
+		}
+
+		char resp_cookies[BUF_SIZE_256] = {0};
+
+		if (method && url && version && strcmp(method, "GET") == 0) {
+			char *path = strtok(url, "?");
+			char *query = strtok(NULL, "?");
 			int byhand=0;
 
-            kv_map params={NULL,0};
-            kv_map* p_params=NULL;
-            if(query!=NULL && strlen(query)>0){
-                // web_debug("query: %d %s \n",strlen(query),query);
+			kv_map params={NULL,0};
+			kv_map* p_params=NULL;
+			if(query!=NULL && strlen(query)>0){
+				// web_debug("query: %d %s \n",strlen(query),query);
 
-                params = parse_get_params(query);
-                p_params= &params;
+				params = parse_get_params(query);
+				p_params= &params;
 
-                kv_pair *current = params.head;
-                while (current) {
-                    // web_debug("\t %s = %s\n", current->key, current->value);
+				kv_pair *current = params.head;
+				while (current) {
+					// web_debug("\t %s = %s\n", current->key, current->value);
 					if(strcmp(current->key,"byhand")==0){
-                        byhand = strcmp(current->value,"0")==0?0:1;
-                    }
-                    current = current->next;
-                }
-            }else{
-                web_debug("\t query is empty ;\n");
-            }
- 			if(strcmp(path, "/")==0  || strcmp(path, "/index.html")==0){
-                web_debug("GET location: index.html \n");
-
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0){
-                    // web_debug("redirect to info.html (%s)\n",found_session_user_name);
-                    send_redirect(conn,"/info.html",NULL);
-
-                }else{
-                   // send_response_content(conn,NULL, login_html);
-                    // web_debug("redirect to login.html \n");
+						byhand = strcmp(current->value,"0")==0?0:1;
+					}
+					current = current->next;
+				}
+			}else{
+				web_debug("\t query is empty ;\n");
+			}
+			if(strcmp(path, "/")==0  || strcmp(path, "/index.html")==0){
+				web_debug("GET location: index.html \n");
+
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0){
+					// web_debug("redirect to info.html (%s)\n",found_session_user_name);
+					send_redirect(conn,"/info.html",NULL);
+
+				}else{
+					// send_response_content(conn,NULL, login_html);
+					// web_debug("redirect to login.html \n");
 					sprintf(resp_cookies, "Set-Cookie: sid=; Max-Age=0; Path=/\r\n");
-                    send_redirect(conn,"/login.html",resp_cookies);
-                    // send_redirect(conn,"/login.html",NULL);
-                }
+					send_redirect(conn,"/login.html",resp_cookies);
+					// send_redirect(conn,"/login.html",NULL);
+				}
 
 
-            }else if(strcmp(path, "/login.html")==0){
-                web_debug("GET location: login.html \n");
-                // strcpy(resp_cookies,"Set-Cookie: user=zhansan; Max-Age=3600; Path=/\r\n");
-                // strcpy(resp_cookies,"");
-                // send_200_response(conn);
-                send_response_content(conn,NULL, (char *)login_html);
+			}else if(strcmp(path, "/login.html")==0){
+				web_debug("GET location: login.html \n");
+				// strcpy(resp_cookies,"Set-Cookie: user=zhansan; Max-Age=3600; Path=/\r\n");
+				// strcpy(resp_cookies,"");
+				// send_200_response(conn);
+				send_response_content(conn,NULL, (char *)login_html);
 
-            }else if(strcmp(path, "/info.html")==0){
-                web_debug("GET location: info.html \n");
+			}else if(strcmp(path, "/info.html")==0){
+				web_debug("GET location: info.html \n");
 
 				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
-               		send_response_content(conn,resp_cookies, (char *)info_html);
+					send_response_content(conn,resp_cookies, (char *)info_html);
 				}else{
 					sprintf(resp_cookies, "Set-Cookie: sid=; Max-Age=0; Path=/\r\n");
-                    send_redirect(conn,"/login.html",resp_cookies);
+					send_redirect(conn,"/login.html",resp_cookies);
 				}
 
-            }else if(strcmp(path,"/modify_account.html")==0){
+			}else if(strcmp(path,"/modify_account.html")==0){
 				web_debug("GET location: modify_account.html \n");
 				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0){
 					LWIP_ASSERT("strlen(found_session_user_name)<BUF_SIZE_64",strlen(found_session_user_name)<BUF_SIZE_64);
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
-               		send_response_content(conn,resp_cookies, (char *)modify_account_html);
+					send_response_content(conn,resp_cookies, (char *)modify_account_html);
 				}else{
 					// web_debug("redirect to login.html \n");
 					sprintf(resp_cookies, "Set-Cookie: sid=; Max-Age=0; Path=/\r\n");
-                    send_redirect(conn,"/login.html",resp_cookies);
+					send_redirect(conn,"/login.html",resp_cookies);
 				}
 
 
@@ -10821,8 +10821,8 @@ int get_soc_status()
 				web_debug("GET location: power_status \n");
 				int power_status=get_power_status();
 				char json_response[BUF_SIZE_128]={0};
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"power_status\":\"%d\"}}";//0 success, msg
-                sprintf(json_response, json_response_patt,power_status);
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"power_status\":\"%d\"}}";//0 success, msg
+				sprintf(json_response, json_response_patt,power_status);
 
 				char response_header[BUF_SIZE_256];
 				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
@@ -10833,17 +10833,17 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 			}else if(strcmp(path, "/power_lostresume_status")==0 ){ //get
 				web_debug("GET location: power_lostresume_status \n");
 				int power_lostresume_status=get_power_lost_resume_attr();
 				char json_response[BUF_SIZE_128]={0};
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"power_lostresume_status\":\"%d\"}}";//0 success, msg
-                sprintf(json_response, json_response_patt,power_lostresume_status);
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"power_lostresume_status\":\"%d\"}}";//0 success, msg
+				sprintf(json_response, json_response_patt,power_lostresume_status);
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -10851,18 +10851,18 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 			}else if(strcmp(path, "/power_consum")==0 ){
 				power_info power_info=get_power_info();
 				char json_response[BUF_SIZE_256]={0};
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"consumption\":\"%d\",\"voltage\":\"%d\",\"current\":\"%d\"}}";//0 success, msg
-                sprintf(json_response, json_response_patt,power_info.consumption,power_info.voltage,power_info.current);
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"consumption\":\"%d\",\"voltage\":\"%d\",\"current\":\"%d\"}}";//0 success, msg
+				sprintf(json_response, json_response_patt,power_info.consumption,power_info.voltage,power_info.current);
 
 
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -10870,8 +10870,8 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
 			}else if(strcmp(path, "/pvt_info")==0 ){
 				web_debug("GET location: pvt_info \n");
@@ -10885,12 +10885,12 @@ int get_soc_status()
 				int rett=get_pvt_info(ppvt_info);
 
 				char json_response[BUF_SIZE_128]={0};
-                char *json_response_patt = "{\"status\":%d,\"message\":\"success\",\"data\":{\"cpu_temp\":\"%d\",\"npu_temp\":\"%d\",\"fan_speed\":\"%d\"}}";
-                sprintf(json_response, json_response_patt,rett,ppvt_info->cpu_temp,ppvt_info->npu_temp,ppvt_info->fan_speed);
+				char *json_response_patt = "{\"status\":%d,\"message\":\"success\",\"data\":{\"cpu_temp\":\"%d\",\"npu_temp\":\"%d\",\"fan_speed\":\"%d\"}}";
+				sprintf(json_response, json_response_patt,rett,ppvt_info->cpu_temp,ppvt_info->npu_temp,ppvt_info->fan_speed);
 
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -10899,19 +10899,19 @@ int get_soc_status()
 				}
 
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
 			}else if(strcmp(path, "/dip_switch")==0 ){ //get dip_switch
 				web_debug("GET location: dip_switch \n");
 				DIPSwitchInfo dipSwitchInfo= {0};
 				get_dip_switch(&dipSwitchInfo);
 				char json_response[BUF_SIZE_128]={0};
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"dip01\":\"%d\",\"dip02\":\"%d\",\"dip03\":\"%d\",\"dip04\":\"%d\",\"swctrl\":\"%d\"}}";
-                sprintf(json_response, json_response_patt,dipSwitchInfo.dip01,dipSwitchInfo.dip02,dipSwitchInfo.dip03,dipSwitchInfo.dip04,dipSwitchInfo.swctrl);
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"dip01\":\"%d\",\"dip02\":\"%d\",\"dip03\":\"%d\",\"dip04\":\"%d\",\"swctrl\":\"%d\"}}";
+				sprintf(json_response, json_response_patt,dipSwitchInfo.dip01,dipSwitchInfo.dip02,dipSwitchInfo.dip03,dipSwitchInfo.dip04,dipSwitchInfo.swctrl);
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -10920,20 +10920,20 @@ int get_soc_status()
 				}
 
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
 
 			}else if(strcmp(path, "/network")==0 ){
 				web_debug("GET location: network \n");
 				char json_response[BUF_SIZE_256]={0};
 				NETInfo netinfo=get_net_info();
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"ipaddr\":\"%s\",\"gateway\":\"%s\",\"subnetwork\":\"%s\",\"macaddr\":\"%s\"}}";//0 success, msg
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"ipaddr\":\"%s\",\"gateway\":\"%s\",\"subnetwork\":\"%s\",\"macaddr\":\"%s\"}}";//0 success, msg
 
-                sprintf(json_response, json_response_patt,netinfo.ipaddr,netinfo.gateway,netinfo.subnetwork,netinfo.macaddr);
+				sprintf(json_response, json_response_patt,netinfo.ipaddr,netinfo.gateway,netinfo.subnetwork,netinfo.macaddr);
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -10941,45 +10941,45 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
-
-            }else if(strcmp(path, "/fake_add_session")==0 ){
-                web_debug("GET location: fake_add_session \n");
-                char* randinfo=NULL;
-                kv_pair *current = params.head;
-                while (current) {
-                    // web_debug("%s = %s\n", current->key, current->value);
-                    if(strcmp(current->key,"randinfo")==0){
-                        randinfo= current->value;
-                        break;
-                    }
-                    current = current->next;
-                }
-                LWIP_ASSERT("randinfo!=NULL",randinfo!=NULL);
-
-                //add sessions
-                char session_id[SESSION_ID_LENGTH + 1];
-                generate_session_id(session_id, SESSION_ID_LENGTH);
-                // web_debug("session add user,sessionId:%s \n",session_id);
-
-                Session *session1 = create_session(session_id, randinfo);
-                add_session(session1);
-
-            }else if(strcmp(path, "/jquery.min.js")==0 ){	//static file,css, js
-                web_debug("GET location: jquery.min.js \n");
-
-                char http_jquery_200_patt[] =  "HTTP/1.1 200 OK\r\n"\
-                    "Content-Type: text/javascript\r\n"\
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+
+			}else if(strcmp(path, "/fake_add_session")==0 ){
+				web_debug("GET location: fake_add_session \n");
+				char* randinfo=NULL;
+				kv_pair *current = params.head;
+				while (current) {
+					// web_debug("%s = %s\n", current->key, current->value);
+					if(strcmp(current->key,"randinfo")==0){
+						randinfo= current->value;
+						break;
+					}
+					current = current->next;
+				}
+				LWIP_ASSERT("randinfo!=NULL",randinfo!=NULL);
+
+				//add sessions
+				char session_id[SESSION_ID_LENGTH + 1];
+				generate_session_id(session_id, SESSION_ID_LENGTH);
+				// web_debug("session add user,sessionId:%s \n",session_id);
+
+				Session *session1 = create_session(session_id, randinfo);
+				add_session(session1);
+
+			}else if(strcmp(path, "/jquery.min.js")==0 ){	//static file,css, js
+				web_debug("GET location: jquery.min.js \n");
+
+				char http_jquery_200_patt[] =  "HTTP/1.1 200 OK\r\n"\
+					"Content-Type: text/javascript\r\n"\
 					"Content-Length: %d\r\n"\
-                    "Connection: close\r\n\r\n"  ;
+					"Connection: close\r\n\r\n"  ;
 
-                char response_header[BUF_SIZE_256];
-                sprintf(response_header, http_jquery_200_patt,  sizeof(data_jquery_min_js));
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				char response_header[BUF_SIZE_256];
+				sprintf(response_header, http_jquery_200_patt,  sizeof(data_jquery_min_js));
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
 				send_large_data(conn, (char *)data_jquery_min_js,  sizeof(data_jquery_min_js));
-            }else if(strcmp(path, "/board_info_som")==0 ){
-                web_debug("GET location: board_info_som \n");
+			}else if(strcmp(path, "/board_info_som")==0 ){
+				web_debug("GET location: board_info_som \n");
 				som_info example= {
 					.magic = -1,
 					.version = -1,
@@ -10994,11 +10994,11 @@ int get_soc_status()
 				int rett = get_som_info(pSimpleInfo);
 
 				char json_response[BUF_SIZE_256]={0};
-                char *json_response_patt = "{\"status\":%d,\"message\":\"success\",\"data\":{\"magicNumber\":\"%x\",\"formatVersionNumber\":\"%x\",\"productIdentifier\":\"%x\",\"pcbRevision\":\"%x\",\"boardSerialNumber\":\"%.18s\"}}";
-                sprintf(json_response, json_response_patt,rett,pSimpleInfo->magic,pSimpleInfo->version,pSimpleInfo->id ,pSimpleInfo->pcb,pSimpleInfo->sn);
+				char *json_response_patt = "{\"status\":%d,\"message\":\"success\",\"data\":{\"magicNumber\":\"%x\",\"formatVersionNumber\":\"%x\",\"productIdentifier\":\"%x\",\"pcbRevision\":\"%x\",\"boardSerialNumber\":\"%.18s\"}}";
+				sprintf(json_response, json_response_patt,rett,pSimpleInfo->magic,pSimpleInfo->version,pSimpleInfo->id ,pSimpleInfo->pcb,pSimpleInfo->sn);
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -11006,19 +11006,19 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
-            }else if(strcmp(path, "/board_info_cb")==0 ){
-                web_debug("GET location: board_info_cb \n");
+			}else if(strcmp(path, "/board_info_cb")==0 ){
+				web_debug("GET location: board_info_cb \n");
 				CBSimpleInfo simpleInfo=get_cb_info();
 
-               	char json_response[BUF_SIZE_256]={0};
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"magicNumber\":\"%x\",\"formatVersionNumber\":\"%x\",\"productIdentifier\":\"%x\",\"pcbRevision\":\"%x\",\"boardSerialNumber\":\"%.18s\"}}";
-                sprintf(json_response, json_response_patt,simpleInfo.magicNumber,simpleInfo.formatVersionNumber, simpleInfo.productIdentifier,simpleInfo.pcbRevision,simpleInfo.boardSerialNumber);
+				char json_response[BUF_SIZE_256]={0};
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"magicNumber\":\"%x\",\"formatVersionNumber\":\"%x\",\"productIdentifier\":\"%x\",\"pcbRevision\":\"%x\",\"boardSerialNumber\":\"%.18s\"}}";
+				sprintf(json_response, json_response_patt,simpleInfo.magicNumber,simpleInfo.formatVersionNumber, simpleInfo.productIdentifier,simpleInfo.pcbRevision,simpleInfo.boardSerialNumber);
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -11026,22 +11026,22 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
-            }else if(strcmp(path, "/rtc")==0 ){
-                web_debug("GET location: rtc \n");
+			}else if(strcmp(path, "/rtc")==0 ){
+				web_debug("GET location: rtc \n");
 				RTCInfo rtcInfo = {0};
 				get_rtcinfo(&rtcInfo);
 
-               	char json_response[BUF_SIZE_256]={0};
-				 // 创建JSON格式的字符串
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"year\":\"%d\",\"month\":\"%d\",\"date\":\"%d\",\"weekday\":\"%d\",\"hours\":\"%d\",\"minutes\":\"%d\",\"seconds\":\"%d\"}}";
-                sprintf(json_response, json_response_patt,rtcInfo.year,rtcInfo.month,rtcInfo.date,rtcInfo.weekday,rtcInfo.hours,rtcInfo.minutes,rtcInfo.seconds);
+				char json_response[BUF_SIZE_256]={0};
+				// 创建JSON格式的字符串
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"year\":\"%d\",\"month\":\"%d\",\"date\":\"%d\",\"weekday\":\"%d\",\"hours\":\"%d\",\"minutes\":\"%d\",\"seconds\":\"%d\"}}";
+				sprintf(json_response, json_response_patt,rtcInfo.year,rtcInfo.month,rtcInfo.date,rtcInfo.weekday,rtcInfo.hours,rtcInfo.minutes,rtcInfo.seconds);
 
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -11049,20 +11049,20 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
-            }else if(strcmp(path, "/soc-status")==0){
+			}else if(strcmp(path, "/soc-status")==0){
 				web_debug("GET location: soc-status \n");
 				int ret=get_soc_status();
 
-               	char json_response[BUF_SIZE_128]={0};
-                char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"status\":\"%d\"}}";
-                sprintf(json_response, json_response_patt,ret);
+				char json_response[BUF_SIZE_128]={0};
+				char *json_response_patt = "{\"status\":0,\"message\":\"success\",\"data\":{\"status\":\"%d\"}}";
+				sprintf(json_response, json_response_patt,ret);
 
 
-                char response_header[BUF_SIZE_256];
-                if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
+				char response_header[BUF_SIZE_256];
+				if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 && byhand ){
 					found_session->tick_value=HAL_GetTick();
 					sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -11070,70 +11070,70 @@ int get_soc_status()
 					sprintf(response_header, json_header, strlen(json_response));
 				}
 
-                netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+				netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 			}else{
-                web_debug("ERROR unsupport get path \n");
-                send_response_200(conn);
-            }
-
-            if(p_params!=NULL){
-                free_kv_map(&params);
-                p_params=NULL;
-            }
-        }else if(method && url && version && strcmp(method, "POST") == 0)
-        {
-            web_debug("func:httpserver_serve method:POST  enter \n");
-            if(strlen(buf)>TCP_MSS){
+				web_debug("ERROR unsupport get path \n");
+				send_response_200(conn);
+			}
+
+			if(p_params!=NULL){
+				free_kv_map(&params);
+				p_params=NULL;
+			}
+		}else if(method && url && version && strcmp(method, "POST") == 0)
+		{
+			web_debug("func:httpserver_serve method:POST  enter \n");
+			if(strlen(buf)>TCP_MSS){
 				char response_413_body[BUF_SIZE_64] = {0};
 				sprintf(response_413_body, "Request header Too Large header:%d,TCP_MSS:%d ",strlen(buf),TCP_MSS);
 				char response_413_header[BUF_SIZE_128] = {0};
 				sprintf(response_413_header, "HTTP/1.1 413  \r\nConnection: close\r\nContent-Length: %d\r\n\r\n",strlen(response_413_body));
-                // const char *response = "HTTP/1.1 413 Request Entity Too Large\r\nContent-Length: 0\r\n\r\n";
-                netconn_write(conn, response_413_header, strlen(response_413_header), NETCONN_COPY);
+				// const char *response = "HTTP/1.1 413 Request Entity Too Large\r\nContent-Length: 0\r\n\r\n";
+				netconn_write(conn, response_413_header, strlen(response_413_header), NETCONN_COPY);
 				netconn_write(conn, response_413_body, strlen(response_413_body), NETCONN_COPY);
-            }else{
-                char *path = strtok(url, "?");
-                // ---------------- query info ---------------
-                //  Content-Length
-                char *content_length_str = strstr(buf, "Content-Length: ");
-                int content_length = 0;
-                if (content_length_str) {
-                    content_length_str += strlen("Content-Length: ");
-                    char *end_of_content_length = strstr(content_length_str, "\r\n");
-                    if (end_of_content_length) {
-                        char len_str[16] = {0};
-                        strncpy(len_str, content_length_str, end_of_content_length - content_length_str);
-                        content_length = atoi(len_str);
-                    }
-                }
-                // web_debug("content_length:%d \n",content_length);
-                // web_debug("########### buf hex##############\n");
-                // for (int i = 0; i < strlen(buf); i++) {
-                //     web_debug("%02X ", buf[i]);
-                //     if(i%16==15){
-                //         web_debug("\n");
-                //     }
-                // }
-                // web_debug("\n");
-
-                char *body_start = strstr(buf, "\r\n\r\n");
-
-                if (body_start) {
-                    body_start += 4;
-                } else {
-                    web_debug("Could not find the body of the POST request. \n body_start strlen() %d \n",strlen(body_start));
-                }
+			}else{
+				char *path = strtok(url, "?");
+				// ---------------- query info ---------------
+				//  Content-Length
+				char *content_length_str = strstr(buf, "Content-Length: ");
+				int content_length = 0;
+				if (content_length_str) {
+					content_length_str += strlen("Content-Length: ");
+					char *end_of_content_length = strstr(content_length_str, "\r\n");
+					if (end_of_content_length) {
+						char len_str[16] = {0};
+						strncpy(len_str, content_length_str, end_of_content_length - content_length_str);
+						content_length = atoi(len_str);
+					}
+				}
+				// web_debug("content_length:%d \n",content_length);
+				// web_debug("########### buf hex##############\n");
+				// for (int i = 0; i < strlen(buf); i++) {
+				// 	web_debug("%02X ", buf[i]);
+				// 	if(i%16==15){
+				// 		web_debug("\n");
+				// 	}
+				// }
+				// web_debug("\n");
+
+				char *body_start = strstr(buf, "\r\n\r\n");
+
+				if (body_start) {
+					body_start += 4;
+				} else {
+					web_debug("Could not find the body of the POST request. \n body_start strlen() %d \n",strlen(body_start));
+				}
 				LWIP_ASSERT("content_length==0||(content_length>0&&body_start)",content_length==0||(content_length>0&&body_start));
 
-                char* query=pvPortMalloc(sizeof(char)*(content_length+1));
+				char* query=pvPortMalloc(sizeof(char)*(content_length+1));
 
-                strncpy(query, body_start , content_length);
-                query[content_length] = '\0';
+				strncpy(query, body_start , content_length);
+				query[content_length] = '\0';
 
-                // web_debug("query %d %s.\n",strlen(query),query);
-                // ------- end query info ---------------
-				//  web_debug("########### query hex##############\n");
+				/* ------- end query info ---------------*/
+				// web_debug("query %d %s.\n",strlen(query),query);
+				// web_debug("########### query hex##############\n");
 				// 	for (int i = 0; i < strlen(query); i++) {
 				// 		web_debug("%02X,%c ", query[i],query[i]);
 				// 		if(i%16==15){
@@ -11141,49 +11141,49 @@ int get_soc_status()
 				// 		}
 				// 	}
 				// 	web_debug("\n");
-				//  web_debug("POST path:%s query:%s \n",path,query);
-				//  web_debug("start parse post query \n");
-                kv_map params={NULL,0};
-                kv_map* p_params=NULL;
-                if(strlen(query)>0){
-                     params = parse_get_params(query);
-                     p_params = &params;
-
-                    kv_pair *current = params.head;
-                    while (current) {
-                        web_debug("%s = %s\n", current->key, current->value);
-                        current = current->next;
-                    }
-                }
+				// web_debug("POST path:%s query:%s \n",path,query);
+				// web_debug("start parse post query \n");
+				kv_map params={NULL,0};
+				kv_map* p_params=NULL;
+				if(strlen(query)>0){
+					params = parse_get_params(query);
+					p_params = &params;
+
+					kv_pair *current = params.head;
+					while (current) {
+						web_debug("%s = %s\n", current->key, current->value);
+						current = current->next;
+					}
+				}
 				vPortFree(query);
 
-                if(strcmp(path, "/login")==0 ){		//login
-                    web_debug("POST location: login \n");
-                    char* username=NULL;
-                    char* password=NULL;
+				if(strcmp(path, "/login")==0 ){		//login
+					web_debug("POST location: login \n");
+					char* username=NULL;
+					char* password=NULL;
 					LWIP_ASSERT("p_params!=NULL",p_params!=NULL);
-                    kv_pair *current = params.head;
-                    while (current) {
-                        if(strcmp(current->key,"username")==0){
-                            username= current->value;
-                            if(password!=NULL){//two param is found
-                                break;
-                            }
-                        }
-                        if(strcmp(current->key,"password")==0){
-                            password= current->value;
-                            if(username!=NULL){//two param is found
-                                break;
-                            }
-                        }
-                        current = current->next;
-                    }
+					kv_pair *current = params.head;
+					while (current) {
+						if(strcmp(current->key,"username")==0){
+							username= current->value;
+							if(password!=NULL){//two param is found
+								break;
+							}
+						}
+						if(strcmp(current->key,"password")==0){
+							password= current->value;
+							if(username!=NULL){//two param is found
+								break;
+							}
+						}
+						current = current->next;
+					}
 					LWIP_ASSERT("username!=NULL && password!=NULL",username!=NULL && password!=NULL);
 
-                    bool loginSuccess = validate_credentials(username,password)==0?TRUE:FALSE;
+					bool loginSuccess = validate_credentials(username,password)==0?TRUE:FALSE;
 					char *json_response=NULL;
 					char response_header[BUF_SIZE_256];
-                    if(loginSuccess){
+					if(loginSuccess){
 						int del_count = delete_timeout_session();
 						web_debug("delete_timeout_session ret:%d \n",del_count);
 						int aval_session_count=0;
@@ -11209,43 +11209,43 @@ int get_soc_status()
 
 						}
 
-                    }else{
+					}else{
 						json_response="{\"status\":1,\"message\":\"username or password not right!\",\"data\":{}}";
 
 						sprintf(resp_cookies, "Set-Cookie: sid=; Max-Age=0; Path=/\r\n");
 						sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
-                    }
+					}
 
 					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
 					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
-                }else if(strcmp(path,"/modify_account")==0){
+				}else if(strcmp(path,"/modify_account")==0){
 					web_debug("POST location: modify_account \n");
 
 					char* username=NULL;
-                    char* password=NULL;
+					char* password=NULL;
 					LWIP_ASSERT("p_params!=NULL", p_params!=NULL);
-                    kv_pair *current = params.head;
-                    while (current) {
-                        if(strcmp(current->key,"password")==0){
-                            password= current->value;
-                        }else if(strcmp(current->key,"username")==0){
-                            username= current->value;
-                        }
-                        current = current->next;
-                    }
+					kv_pair *current = params.head;
+					while (current) {
+						if(strcmp(current->key,"password")==0){
+							password= current->value;
+						}else if(strcmp(current->key,"username")==0){
+							username= current->value;
+						}
+						current = current->next;
+					}
 					LWIP_ASSERT("password!=NULL&&username!=NULL!", password!=NULL&&username!=NULL);
 
 					int ret =save_sys_username_password(username,password);//save new username ,password to eeprom
 
 					char *json_response=NULL;
 					char response_header[BUF_SIZE_256];
-					 if(ret==0){
+					if(ret==0){
 						json_response="{\"status\":0,\"message\":\"failt\",\"data\":{}}";
 
 						sprintf(resp_cookies, "Set-Cookie: sid=; Max-Age=0; Path=/\r\n");//clear cookie
 						sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
-                    }else{
+					}else{
 						json_response="{\"status\":1,\"message\":\"failt\",\"data\":{}}";
 						sprintf(response_header, json_header, strlen(json_response));
 
@@ -11253,31 +11253,31 @@ int get_soc_status()
 					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
 					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 				}else if(strcmp(path, "/logout")==0 ){		//login_out
-                    web_debug("POST location: logout \n");
-                    if(found_session_user_name!=NULL && strlen(found_session_user_name)>0){//todo verify user_name in txt config(valid)
-                        if(sidValue!=NULL){
-                            int rett=delete_session(sidValue);
+					web_debug("POST location: logout \n");
+					if(found_session_user_name!=NULL && strlen(found_session_user_name)>0){//todo verify user_name in txt config(valid)
+						if(sidValue!=NULL){
+							int rett=delete_session(sidValue);
 							LWIP_ASSERT("delete sidValue failed!", rett>0);
-                        }
-                    }
+						}
+					}
 					char response_header[BUF_SIZE_256];
 					char *json_response="{\"status\":0,\"message\":\"failt\",\"data\":{}}";
 					sprintf(resp_cookies, "Set-Cookie: sid=; Max-Age=0; Path=/\r\n");//clear cookie
 					sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
 					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
 					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
-                }else if(strcmp(path, "/power_status")==0 ){
+				}else if(strcmp(path, "/power_status")==0 ){
 					web_debug("POST location: power_status \n");
-                    char* status=NULL;
+					char* status=NULL;
 					LWIP_ASSERT("p_params!=NULL", p_params!=NULL);
-                    kv_pair *current = params.head;
-                    while (current) {
-                        if(strcmp(current->key,"power_status")==0){
-                            status= current->value;
-                                break;
-                        }
-                        current = current->next;
-                    }
+					kv_pair *current = params.head;
+					while (current) {
+						if(strcmp(current->key,"power_status")==0){
+							status= current->value;
+								break;
+						}
+						current = current->next;
+					}
 					LWIP_ASSERT("status!=NULL", status!=NULL);
 
 					int change_status_ret=0;
@@ -11287,7 +11287,7 @@ int get_soc_status()
 						change_status_ret=change_power_status(1);
 					}
 
-                    char *json_response_patt =NULL;
+					char *json_response_patt =NULL;
 					char json_response[BUF_SIZE_64]={0};
 
 					if(change_status_ret==0){
@@ -11298,7 +11298,7 @@ int get_soc_status()
 						sprintf(json_response, json_response_patt, change_status_ret,change_status_ret);
 					}
 
-                    char response_header[BUF_SIZE_256];
+					char response_header[BUF_SIZE_256];
 					if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 ){
 						found_session->tick_value=HAL_GetTick();
 						sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
@@ -11307,21 +11307,21 @@ int get_soc_status()
 						sprintf(response_header, json_header, strlen(json_response));
 					}
 
-                    netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                    netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
 				}else if(strcmp(path, "/power_lostresume_status")==0 ){
 					web_debug("POST location: power_lostresume_status \n");
-                    char* status=NULL;
+					char* status=NULL;
 					LWIP_ASSERT("p_params!=NULL", p_params!=NULL);
-                    kv_pair *current = params.head;
-                    while (current) {
-                        if(strcmp(current->key,"power_lostresume_status")==0){
-                            status= current->value;
-                                break;
-                        }
-                        current = current->next;
-                    }
+					kv_pair *current = params.head;
+					while (current) {
+						if(strcmp(current->key,"power_lostresume_status")==0){
+							status= current->value;
+								break;
+						}
+						current = current->next;
+					}
 					LWIP_ASSERT("status!=NULL", status!=NULL);
 
 					int change_status_ret=0;
@@ -11331,7 +11331,7 @@ int get_soc_status()
 						change_status_ret=change_power_lost_resume_attr(1);
 					}
 
-                    char *json_response_patt =NULL;
+					char *json_response_patt =NULL;
 					char json_response[BUF_SIZE_64]={0};
 
 					if(change_status_ret==0){
@@ -11342,7 +11342,7 @@ int get_soc_status()
 						sprintf(json_response, json_response_patt, change_status_ret,change_status_ret);
 					}
 
-                    char response_header[BUF_SIZE_256];
+					char response_header[BUF_SIZE_256];
 					if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 ){
 						found_session->tick_value=HAL_GetTick();
 						sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
@@ -11351,13 +11351,13 @@ int get_soc_status()
 						sprintf(response_header, json_header, strlen(json_response));
 					}
 
-                    netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                    netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 
 				}else if(strcmp(path, "/reset")==0 ){
 					web_debug("POST location: reset \n");
 					int reset_ret=xSOMRebootHandle();
-                    char *json_response_patt =NULL;
+					char *json_response_patt =NULL;
 					char json_response[BUF_SIZE_64]={0};
 					if(reset_ret==0){
 						json_response_patt="{\"status\":%d,\"message\":\"success!\",\"data\":{}}";//0 success, msg
@@ -11367,7 +11367,7 @@ int get_soc_status()
 						sprintf(json_response, json_response_patt, reset_ret,reset_ret);
 					}
 
-                    char response_header[BUF_SIZE_256];
+					char response_header[BUF_SIZE_256];
 					if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 ){
 						found_session->tick_value=HAL_GetTick();
 						sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
@@ -11376,38 +11376,38 @@ int get_soc_status()
 						sprintf(response_header, json_header, strlen(json_response));
 					}
 
-                    netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                    netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 				}else if(strcmp(path, "/dip_switch")==0 ){
 					web_debug("POST location: dip_switch \n");
 
 					DIPSwitchInfo dipSwitchInfo;
 					LWIP_ASSERT("p_params!=NULL", p_params!=NULL);
-                    kv_pair *current = params.head;
+					kv_pair *current = params.head;
 					char *endPtr;
 					long intValue =0;
-                    while (current) {
-                        if(strcmp(current->key,"dip01")==0){
+					while (current) {
+						if(strcmp(current->key,"dip01")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							dipSwitchInfo.dip01= intValue>0?1:0;
+						}else if(strcmp(current->key,"dip02")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							dipSwitchInfo.dip02= intValue>0?1:0;
+						}else if(strcmp(current->key,"dip03")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							dipSwitchInfo.dip03= intValue>0?1:0;
+						}else if(strcmp(current->key,"dip04")==0){
 							intValue = strtol(current->value, &endPtr, 10);
-                            dipSwitchInfo.dip01= intValue>0?1:0;
-                        }else if(strcmp(current->key,"dip02")==0){
+							dipSwitchInfo.dip04= intValue>0?1:0;
+						}else if(strcmp(current->key,"swctrl")==0){
 							intValue = strtol(current->value, &endPtr, 10);
-                            dipSwitchInfo.dip02= intValue>0?1:0;
-                        }else if(strcmp(current->key,"dip03")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            dipSwitchInfo.dip03= intValue>0?1:0;
-                        }else if(strcmp(current->key,"dip04")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            dipSwitchInfo.dip04= intValue>0?1:0;
-                        }else if(strcmp(current->key,"swctrl")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            dipSwitchInfo.swctrl= intValue>0?1:0;
-                        }
-                        current = current->next;
-                    }
+							dipSwitchInfo.swctrl= intValue>0?1:0;
+						}
+						current = current->next;
+					}
 					int set_ret=set_dip_switch(dipSwitchInfo);
 
-                    char *json_response_patt =NULL;
+					char *json_response_patt =NULL;
 					char json_response[BUF_SIZE_64]={0};
 					if(set_ret==0){
 						json_response_patt="{\"status\":%d,\"message\":\"success!\",\"data\":{}}";//0 success, msg
@@ -11417,8 +11417,8 @@ int get_soc_status()
 						sprintf(json_response, json_response_patt, set_ret,set_ret);
 					}
 
-                    char response_header[BUF_SIZE_256];
-                    if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 ){
+					char response_header[BUF_SIZE_256];
+					if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 ){
 						found_session->tick_value=HAL_GetTick();
 						sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
 						sprintf(response_header, json_header_withcookie,resp_cookies, strlen(json_response));
@@ -11426,29 +11426,29 @@ int get_soc_status()
 						sprintf(response_header, json_header, strlen(json_response));
 					}
 
-                    netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                    netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
 				}else if(strcmp(path, "/network")==0 ){		//post network
-                    web_debug("POST location: network \n");
+					web_debug("POST location: network \n");
 
-                    char* ipaddr=NULL;
-                    char* gateway=NULL;
-                    char* subnetwork=NULL;
+					char* ipaddr=NULL;
+					char* gateway=NULL;
+					char* subnetwork=NULL;
 					char* macaddr=NULL;
 
-                    kv_pair *current = params.head;
-                    while (current) {
-                        if(strcmp(current->key,"ipaddr")==0){
-                            ipaddr= current->value;
-                        }else if(strcmp(current->key,"gateway")==0){
-                            gateway= current->value;
-                        }else if(strcmp(current->key,"subnetwork")==0){
-                            subnetwork= current->value;
-                        }else if(strcmp(current->key,"macaddr")==0){
-                            macaddr= current->value;
-                        }
-                        current = current->next;
-                    }
+					kv_pair *current = params.head;
+					while (current) {
+						if(strcmp(current->key,"ipaddr")==0){
+							ipaddr= current->value;
+						}else if(strcmp(current->key,"gateway")==0){
+							gateway= current->value;
+						}else if(strcmp(current->key,"subnetwork")==0){
+							subnetwork= current->value;
+						}else if(strcmp(current->key,"macaddr")==0){
+							macaddr= current->value;
+						}
+						current = current->next;
+					}
 					LWIP_ASSERT("ipaddr!=NULL&&gateway!=NULL&&subnetwork!=NULL&&macaddr!=NULL", ipaddr!=NULL&&gateway!=NULL&&subnetwork!=NULL&&macaddr!=NULL);
 					unescape_colon(macaddr);
 					LWIP_ASSERT("strlen(ipaddr)<16 && strlen(macaddr)<18 &&strlen(subnetwork)<16 && strlen(gateway)<16 ", strlen(ipaddr)<16 && strlen(macaddr)<18 &&strlen(subnetwork)<16 && strlen(gateway)<16 );
@@ -11465,8 +11465,8 @@ int get_soc_status()
 					netinfo.gateway[strlen(gateway)] = '\0';
 
 					set_net_info(netinfo);
-                    char *json_response = "{\"status\":0,\"message\":\"success\",\"data\":{}}";//0 success, msg
-                    char response_header[BUF_SIZE_256];
+					char *json_response = "{\"status\":0,\"message\":\"success\",\"data\":{}}";//0 success, msg
+					char response_header[BUF_SIZE_256];
 					if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 ){
 						found_session->tick_value=HAL_GetTick();
 						sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
@@ -11475,46 +11475,46 @@ int get_soc_status()
 						sprintf(response_header, json_header, strlen(json_response));
 					}
 
-                    netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                    netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
-                }else if(strcmp(path, "/rtc")==0 ){	//rtc
-                    web_debug("POST location: rtc \n");
+					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+				}else if(strcmp(path, "/rtc")==0 ){	//rtc
+					web_debug("POST location: rtc \n");
 
 					RTCInfo rtcInfo;
 					LWIP_ASSERT("p_params!=NULL", p_params!=NULL);
-                    kv_pair *current = params.head;
+					kv_pair *current = params.head;
 					char *endPtr;
 					long intValue =0;
-                    while (current) {
-                        if(strcmp(current->key,"year")==0){
+					while (current) {
+						if(strcmp(current->key,"year")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							rtcInfo.year= intValue>=0&&intValue<=MAX_YEAR?intValue:-1;
+						}else if(strcmp(current->key,"month")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							rtcInfo.month= intValue>=0&&intValue<=12?intValue:-1;
+						}else if(strcmp(current->key,"date")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							rtcInfo.date= intValue>=0&&intValue<=31?intValue:-1;
+						}else if(strcmp(current->key,"weekday")==0){
 							intValue = strtol(current->value, &endPtr, 10);
-                            rtcInfo.year= intValue>=0&&intValue<=MAX_YEAR?intValue:-1;
-                        }else if(strcmp(current->key,"month")==0){
+							rtcInfo.weekday=  intValue>=0&&intValue<=6?intValue:-1;
+						}else if(strcmp(current->key,"hours")==0){
 							intValue = strtol(current->value, &endPtr, 10);
-                            rtcInfo.month= intValue>=0&&intValue<=12?intValue:-1;
-                        }else if(strcmp(current->key,"date")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            rtcInfo.date= intValue>=0&&intValue<=31?intValue:-1;
-                        }else if(strcmp(current->key,"weekday")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            rtcInfo.weekday=  intValue>=0&&intValue<=6?intValue:-1;
-                        }else if(strcmp(current->key,"hours")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            rtcInfo.hours= intValue>=0&&intValue<=23?intValue:-1;
-                        }else if(strcmp(current->key,"minutes")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            rtcInfo.minutes= intValue>=0&&intValue<=59?intValue:-1;
-                        }else if(strcmp(current->key,"seconds")==0){
-                            intValue = strtol(current->value, &endPtr, 10);
-                            rtcInfo.seconds= intValue>=0&&intValue<=59?intValue:-1;
-                        }
-                        current = current->next;
-                    }
+							rtcInfo.hours= intValue>=0&&intValue<=23?intValue:-1;
+						}else if(strcmp(current->key,"minutes")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							rtcInfo.minutes= intValue>=0&&intValue<=59?intValue:-1;
+						}else if(strcmp(current->key,"seconds")==0){
+							intValue = strtol(current->value, &endPtr, 10);
+							rtcInfo.seconds= intValue>=0&&intValue<=59?intValue:-1;
+						}
+						current = current->next;
+					}
 					LWIP_ASSERT("rtcInfo.year>=0&&rtcInfo.month>=0&&rtcInfo.date>=0&&rtcInfo.weekday>=0&&rtcInfo.hours>=0&&rtcInfo.minutes>=0&& rtcInfo.seconds>=0", rtcInfo.year>=0&&rtcInfo.month>=0&&rtcInfo.date>=0&&rtcInfo.weekday>=0&&rtcInfo.hours>=0&&rtcInfo.minutes>=0&& rtcInfo.seconds>=0);
 
 					int set_ret=set_rtcinfo(rtcInfo);
 
-                    char *json_response_patt =NULL;
+					char *json_response_patt =NULL;
 					char json_response[BUF_SIZE_64]={0};
 					if(set_ret==0){
 						json_response_patt="{\"status\":%d,\"message\":\"success!\",\"data\":{}}";//0 success, msg
@@ -11524,7 +11524,7 @@ int get_soc_status()
 						sprintf(json_response, json_response_patt, set_ret,set_ret);
 					}
 
-                    char response_header[BUF_SIZE_256];
+					char response_header[BUF_SIZE_256];
 					if(found_session_user_name!=NULL && strlen(found_session_user_name)>0 ){
 						found_session->tick_value=HAL_GetTick();
 						sprintf(resp_cookies, "Set-Cookie: sid=%.31s; Max-Age=%d; Path=/\r\n",sidValue,MAX_AGE);
@@ -11533,44 +11533,44 @@ int get_soc_status()
 						sprintf(response_header, json_header, strlen(json_response));
 					}
 
-                    netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
-                    netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
-
-                }else{
-                    send_response_200(conn);
-                }
-
-                if(p_params!=NULL){
-                    free_kv_map(&params);
-                    p_params=NULL;
-                }
-                // web_debug("func:httpserver_serve method:POST  exit \n");
-            }
-        }else{
-            web_debug("ERROR unsupport methoc(only support GET,POST) %s \n",method);
-            send_response_200(conn);
-        }
+					netconn_write(conn, response_header, strlen(response_header), NETCONN_COPY);
+					netconn_write(conn, json_response, strlen(json_response), NETCONN_COPY);
+
+				}else{
+					send_response_200(conn);
+				}
+
+				if(p_params!=NULL){
+					free_kv_map(&params);
+					p_params=NULL;
+				}
+				// web_debug("func:httpserver_serve method:POST  exit \n");
+			}
+		}else{
+			web_debug("ERROR unsupport methoc(only support GET,POST) %s \n",method);
+			send_response_200(conn);
+		}
 		if(cookies_copy!=NULL){
 			free(cookies_copy);
 			cookies_copy=NULL;
 		}
-        free(buf_copy);
+		free(buf_copy);
 		free(found_session_user_name);
-    }else{
+	}else{
 		LWIP_ASSERT("receive ret err != ERR_OK",0);
-    }
+	}
 
-    netbuf_delete(inbuf);
-    // web_debug("http_server_netconn_serve after:netbuf_delete \n");
+	netbuf_delete(inbuf);
+	// web_debug("http_server_netconn_serve after:netbuf_delete \n");
  }
 
- /** The main function, never returns! */
- static void
- http_server_netconn_thread(void *arg)
- {
-     struct netconn *conn, *newconn;
-     err_t err;
-     LWIP_UNUSED_ARG(arg);
+/** The main function, never returns! */
+static void
+http_server_netconn_thread(void *arg)
+{
+	struct netconn *conn, *newconn;
+	err_t err;
+	LWIP_UNUSED_ARG(arg);
 	conn = netconn_new(NETCONN_TCP);
 
 	LWIP_ERROR("http_server: invalid conn", (conn != NULL), return;);
@@ -11603,19 +11603,19 @@ int get_soc_status()
 	web_debug("http_server_netconn_thread after netconn_delete \n");
 
 	// web_debug("http_server_netconn_thread exit \n");
- }
+}
 
- /** Initialize the HTTP server (start its thread) */
- void
- httpserver_init(void)
- {
- 	int ret=(int )sys_thread_new("http_server_netconn", http_server_netconn_thread, NULL, 1024*4, 4);
+/** Initialize the HTTP server (start its thread) */
+void
+httpserver_init(void)
+{
+	int ret=(int )sys_thread_new("http_server_netconn", http_server_netconn_thread, NULL, 1024*4, 4);
 	if (ret<=0){
 		web_debug("ERROR:create thread http_server_netconn_thread failed %d\n", ret);
 	}
 	else {
 		web_debug("create thread http_server_netconn_thread ok!\n");
 	}
- }
+}
 
  #endif
\ No newline at end of file
-- 
2.25.1

